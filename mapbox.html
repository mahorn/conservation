<!DOCTYPE html>
<html>

<head>
    <meta charset='utf-8' />
    <title>mapbox</title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.45.0/mapbox-gl.css' rel='stylesheet' />
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css" />
    <style>
        body {
            margin: 0;
            padding: 0;
        }

        #map {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 100%;
        }
    </style>
</head>

<body>

    <div id='map'></div>

    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
        integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
        integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
        integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
        crossorigin="anonymous"></script>
    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.45.0/mapbox-gl.js'></script>
    <script src="https://d3js.org/d3-fetch.v1.min.js"></script>
    <script src="https://unpkg.com/topojson@3"></script>

    <script>

        mapboxgl.accessToken = 'pk.eyJ1IjoibWFob3JuIiwiYSI6ImNpbnV0enJ4ZTEyNG91YW0zNGF6bTlva2wifQ.7jRtxQoaV2PHlRD7fu6U-g';

        var map = new mapboxgl.Map({
            container: 'map', // container id
            style: 'mapbox://styles/mapbox/light-v9', // stylesheet location
            center: [-65, -25], // starting position [lng, lat]
            zoom: 2.2 // starting zoom
        });

        var oceanOptions = {
            fillOpacity: 0,
            color: '#040d18',
            opacity: 1,
            weight: 3
        };

        var colorCodes = {
            0: "#579cb4",
            200: "#64a4ba",
            1000: "#72acc0",
            2000: "#7fb4c6",
            3000: "#8dbccc",
            4000: "#9bc4d2",
            5000: "#a8ccd8",
            6000: "#b6d4de",
            7000: "#c3dce4",
            8000: "#d1e4ea",
            9000: "#deecf0",
            10000: "#ecf4f6"
        }

        // when the map is done loading
        map.on('load', function () {

            // request our GEOJSON data
            d3.json('data/ocean.json')
                .then(function (data) {
                    console.log(data);
                    oceanMap(data);
                });

            function oceanMap(data) {
                var geojson = topojson.feature(data, data.objects.ocean);
                console.log(geojson);

                map.addLayer({
                    'id': 'ocean',
                    'type': 'fill',
                    'source': {
                        'type': 'geojson',
                        'data': geojson// use the data as the data source
                    },
                    'paint': {
                        "fill-color": [
                            "match", // match the numbers below to the depth
                            ["number", ["get", "depth"]],
                            0, colorCodes[0],
                            200, colorCodes[200],
                            1000, colorCodes[1000],
                            2000, colorCodes[2000],
                            3000, colorCodes[3000],
                            4000, colorCodes[4000],
                            5000, colorCodes[5000],
                            6000, colorCodes[6000],
                            7000, colorCodes[7000],
                            8000, colorCodes[8000],
                            9000, colorCodes[9000],
                            10000, colorCodes[10000],
                            "#000000" // default for no match
                        ],
                        "fill-opacity": 0.3
                    }
                });
            }

            d3.json('data/polygons.json')
                .then(function (data) {
                    console.log(data);
                    polygonsMap(data);
                });

            function polygonsMap(data) {
                var geojson = topojson.feature(data, data.objects.merge_files_sim);
                console.log(geojson);

                map.addLayer({
                    'id': 'polygon',
                    'type': 'fill',
                    'source': {
                        'type': 'geojson',
                        'data': geojson// use the data as the data source
                    },
                    'paint': {
                        "fill-color": "#b9d9c3",
                        "fill-opacity": .75,
                    }
                });
            }

            d3.json('data/points.json')
                .then(function (data) {
                    console.log(data);
                    pointsMap(data);
                });

            function pointsMap(data) {

                map.addLayer({
                    'id': 'points',
                    'type': 'circle',
                    'source': {
                        'type': 'geojson',
                        'data': data,// use the data as the data source
                        'cluster': true,
                        'clusterMaxZoom': 2, // Max zoom to cluster points on
                        'clusterRadius': 10 // Radius of each cluster when clustering points (defaults to 50)
                    },
                    'paint': {
                        "circle-color": '#fbcb7b',
                        "circle-opacity": .75,
                        "circle-radius": 3
                    }
                });
            }
        });
    </script>

</body>

</html>