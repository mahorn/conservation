<!DOCTYPE html>
<html>

<head>
    <meta charset=utf-8 />
    <title>Conservation Areas in South America</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- <script src='https://api.mapbox.com/mapbox.js/v3.2.0/mapbox.js'></script> -->
    <!-- added mapbox-gl-js to see if ocean loads -->
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.53.1/mapbox-gl.css' rel='stylesheet' />
    <!-- end of mapbox-gl-js to see if ocean loads -->
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <link href="https://api.mapbox.com/mapbox-assembly/v0.21.2/assembly.min.css" rel="stylesheet">
    <link href='https://api.mapbox.com/mapbox.js/v3.2.0/mapbox.css' rel='stylesheet' />

    <style>
        body {
            padding-top: 0;
        }
        
        #map {
            padding: 0;
            position: fixed;
            width: 100%;
            height: 100%;
        }
        
        .marker {
            background-image: url('pics/wildlife_icon.png');
            background-size: cover;
            width: 20px;
            height: 20px;
            border-radius: 5%;
            cursor: pointer;
        }
    </style>
</head>

<body>
    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    <!--adding libraries to see if ocean loads-->
    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.53.1/mapbox-gl.js'></script>
    <script src="https://d3js.org/d3.v5.min.js"></script>
    <script src="https://unpkg.com/topojson@3"></script>

    <!--scrolling libraries-->
    <!-- <script src="lib/d3.js"></script>
    <script src="js/scroller.js"></script>
    <script src="js/sections.js"></script> -->

    <div id='map'>

        <script>
            mapboxgl.accessToken = 'pk.eyJ1IjoibWFob3JuIiwiYSI6ImNpbnV0enJ4ZTEyNG91YW0zNGF6bTlva2wifQ.7jRtxQoaV2PHlRD7fu6U-g';

            var map = new mapboxgl.Map({
                container: 'map',
                style: 'mapbox://styles/mapbox/light-v9',
                center: [-65, -15],
                zoom: 2.6,
            });

            map.on('load', function() {

                d3.json('data/points.json')
                    .then(function(data) {
                        pointsMap(data);
                    });

                function pointsMap(data) {
                    map.addLayer({
                        'id': 'points',
                        'type': 'circle',
                        'source': {
                            'type': 'geojson',
                            'data': data
                                //   'cluster': true,
                                //   'clusterMaxZoom': 4, // Max zoom to cluster points on
                                //  'clusterRadius': 2 // Radius of each cluster when clustering points (defaults to 50)
                        },
                        'paint': {
                            'circle-color': [
                                'match', ['get', 'IUCN_CAT'],
                                'Ia', '#505160',
                                'Ib', '#68829e',
                                'II', '#aebd38',
                                'III', '#598234',
                                'IV', '#003b46',
                                'V', '#07575b',
                                'VI', '#66a5ad',
                                'Not Reported', '#c4dfe6',
                                'Not Applicable', '#a2c523',
                                '#ccc'
                            ],
                            'circle-radius': 4,
                            'circle-opacity': .6,
                        },
                    });

                    var popup = new mapboxgl.Popup({
                        closeButton: false,
                        closeOnClick: false
                    });

                    map.on('mousemove', 'points', function(e) {
                        var features = map.queryRenderedFeatures(e.lngLat);
                        map.getCanvas().style.cursor = 'pointer';
                        popup.setLngLat(e.lngLat)
                            .setHTML(String(e.features[0].properties.NAME).toLocaleString())
                            .addTo(map)
                    });
                    map.on('mouseleave', 'points', function() {
                        map.getCanvas().style.cursor = '';
                        popup.remove();
                    });


                    data.features.forEach(function(marker) {
                        //     // create a HTML element for each feature
                        var el = document.createElement('div');
                        el.className = 'marker';
                        //     // make a marker for each feature and add to the map
                        new mapboxgl.Marker(el)
                            .setLngLat(marker.geometry.coordinates)
                            .setPopup(new mapboxgl.Popup({
                                    offset: 25
                                }) // add popups
                                .setHTML('<h3>' + marker.properties.NAME + '</h3><p>' + marker.properties.DESIG_ENG + '</p><p>' + marker.properties.IUCN_CAT + '</p>'))
                            .addTo(map);
                    });

                } //end of function pointsMap
            }); //end of map.on('load')
        </script>

</body>

</html>