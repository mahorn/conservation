<!DOCTYPE html>
<html>

<head>
    <meta charset=utf-8 />
    <title>Conservation Areas in South America</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.53.1/mapbox-gl.css' rel='stylesheet' />
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
        integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <link href="https://api.mapbox.com/mapbox-assembly/v0.21.2/assembly.min.css" rel="stylesheet">
    <link href='https://api.mapbox.com/mapbox.js/v3.2.0/mapbox.css' rel='stylesheet' />
    <link href="https://fonts.googleapis.com/css?family=Roboto:400" rel="stylesheet" />

    <style>
        body {
            padding-top: 0;
            font-family: 'Roboto', sans-serif;
        }

        #map {
            padding: 0;
            position: fixed;
            width: 100%;
            height: 100%;
        }

        /* NAVIGATION BAR */
        .navbar {
            padding-top: 1rem;
            width: 28rem;
            position: fixed;
            background-color: #021c1e;
        }

        .navbar-brand:hover,
        .nav-link:hover {
            opacity: 0.6;
        }

        /* ASIDE BAR */
        aside {
            top: 0;
            right: 0;
            bottom: 0;
            width: 11rem;
            background-color: #021c1e;
            overflow-y: scroll;
        }

        .aside-chapters {
            padding-top: 1rem;
            padding-bottom: 1rem;
            padding-left: 3rem;
        }

        .aside-icons {
            padding-top: 0.5rem;
        }

        /* ICON HOVER */
        a.icon-hover:hover img {
            opacity: 0.6;
        }

        /* POPUPS */
        .mapboxgl-popup {
            max-width: 200px;
        }

        .mapboxgl-popup-content {
            text-align: center;
            font-family: 'Open Sans', sans-serif;
            background: rgba(0, 0, 0, 0.6);
            color: white;
        }

        /* ABOUT BUTTON - MODAL */
        #about-trigger {
            padding: 0;
        }

        #about-global {
            padding: 0;
        }

        #about-modal {
            background: rgba(0, 0, 0, 0.25);
            -webkit-text-fill-color: #b2dbd5;
        }

        /* IUCN BUTTON - MODAL */
        #about-iucn {
            padding: 0;
        }

        #about-global {
            padding: 0;
        }

        #iucn-modal {
            background: rgba(0, 0, 0, 0.25);
            -webkit-text-fill-color: #b2dbd5;
        }

        /* WDPA BUTTON - MODAL */
        #about-wdpa {
            padding: 0;
        }

        #about-global {
            padding: 0;
        }

        #wdpa-modal {
            background: rgba(0, 0, 0, 0.25);
            -webkit-text-fill-color: #b2dbd5;
        }

        /* STORY CHAPTER */
        #features {
            padding-top: 15%;
            padding-left: 3%;
            padding-bottom: 25%;
            width: 31%;
            display: none;
            overflow-y: scroll;
        }

        section {
            padding-right: 0px;
            padding-left: 20px;
            padding-top: 20px;
            padding-bottom: 30px;
            line-height: 25px;
            border-bottom: 1px solid #ddd;
            opacity: 0.8;
            font-size: 16px;
            background-color: #021c1e;
        }

        section.active {
            opacity: 0.5;
            background-color: #021c1e;
        }

        section.active p {
            color: #d4dde1;
            font-size: 14px;
            text-align: justify;
        }

        section:last-child {
            border-bottom: none;
            margin-bottom: 200px;
        }

        h1 {
            font-size: 28px;
            text-align: center;
            color: #d4dde1;
            padding-bottom: 20px;
            padding-top: 10px;
        }

        h2 {
            font-size: 24px;
            text-align: center;
            color: #d4dde1;
            padding-bottom: 20px;
            padding-top: 10px;
        }

        h3 {
            text-align: center;
            color: #d4dde1;
        }

        span {
            color: #2c4a52;
        }

        .quiet {
            color: #c9d1c8;
        }

        .scroll {
            display: block;
            text-align: center;
            padding-top: 20px;
            font-size: 14px;
        }

        /* GALLERY CHAPTER */
        #gallery {
            position: fixed;
            display: none;
            right: 14%;
            top: 0;
            width: 22%;
            height: 100%;
            background: #c9d1c8;
            color: #2c4a52;
            overflow-y: scroll;
        }

        .text-gallery {
            color: #537072;
        }

        .text-gallery-footer {
            color: #2c4a52;
            font-size: 10px;
            font-weight: bold;
        }

        /* EXPLORE CHAPTER */
        #explore {
            position: fixed;
            display: none;
            right: 14%;
            top: 0;
            width: 22%;
            height: 100%;
            background: #c9d1c8;
            color: #2c4a52;
        }

        .text-explore {
            color: #537072;
        }

        .text-explore-footer {
            color: #2c4a52;
            font-size: 10px;
            font-weight: bold;
        }

        /* .marker {
            background-image: url('pics/wildlife_icon.png');
            background-size: cover;
            width: 20px;
            height: 20px;
            border-radius: 5%;
            cursor: pointer;
        } */
    </style>
</head>

<body>
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
        integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
        integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
        crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
        integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
        crossorigin="anonymous"></script>
    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.53.1/mapbox-gl.js'></script>
    <script async defer src="https://api.mapbox.com/mapbox-assembly/v0.21.2/assembly.js"></script>
    <script src="https://d3js.org/d3.v5.min.js"></script>
    <script src="https://unpkg.com/topojson@3"></script>


    <div id='map'></div>
    <!-- end of map -->

    <!-- navigation -->
    <div class='navbar h6 z1'>
        <nav class='navbar navbar-expand-lg fixed-top'>
            <button id='about-icon' class='icon-hover'>
                <a class='navbar-brand color-green-faint' href='#'>CONSERVATION</a></button>
            <ul class='navbar-nav mr-auto'>
                <div id='about-trigger'>
                    <li class='nav-item'><a class='nav-link color-green-faint' href="#">About</a></li>
                </div>
                <div id='about-wdpa'>
                    <li class='nav-item'><a class='nav-link color-green-faint' href="#">WDPA</a></li>
                </div>
                <div id='about-iucn'>
                    <li class='nav-item'><a class='nav-link color-green-faint' href="#">IUCN</a></li>
                </div>
                <li class='nav-item'><a class='nav-link color-green-faint' href="#">Language</a></li>
            </ul>
        </nav>
    </div>

    <!-- about-modal -->
    <div id='about-modal' class='absolute top right bottom left scroll-auto z2 none animation--speed-1'>
        <div
            class='flex-child border border-gray-dark bg-gray-dark color-green-faint round relative w600 mx-auto mt120'>
            <button id='modal-close' class='btn btn-gray-dark absolute top right mr6 mt6 px0 py0'>
                <svg class='icon btn-info link color-lighten50 txt-xl'>
                    <use xlink:href='#icon-close'></use>
                </svg>
            </button>
            <div class='px24 py24'>
                <div class='txt-m mb12 align-center'>CONSERVATION AREAS IN SOUTH AMERICA</div>
                <div class='txt-s text-justify'>
                    For centuries, protected areas of many kinds have played a fundamental role within the world's
                    landscapes and seascapes. They are essential for the conservation of species and ecosystems, and
                    also provide benefits for people. However, protected areas are not isolates entities, their
                    ability to deliver positive outcomes is affected by their surroundings, and they can only work if
                    they are governed and managed as part of the wider landscape, integrated into development strategies
                    and considered across all sectors of society.<br><br>The World Database on Protected Areas (WDPA), a
                    joint effort between the International Union for Conservation of Nature (IUCN) and the United
                    Nations Environment
                    Programme (UNEP), is the only globally authoritative database on marine and terrestrial protected
                    areas of the
                    world. It is compiled and managed by UNEP-WCMC in collaboration with IUCN.<br><br>
                    <p class='text-right color-green-faint'>Map Author:Maria Renee Horn</a><br>Data:
                        <a target="_blank" href="https://www.protectedplanet.net">World Database on Protected Areas</a>-
                        <a target="_blank"
                            href="https://www.iucn.org/theme/protected-areas/about/protected-area-categories">IUCN
                            Protected Area Categories</a>
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- aside chapters -->
    <aside class='aside z3 fixed'>
        <ul class='aside-chapters'>
            <li class='aside-icons'><a class='icon-hover' id='icon-story'><img src='pics/story.png' alt='story icon'
                        style="width:90px;height:90px;"></a></li>
            <li class='aside-icons'><a class="icon-hover" id='icon-gallery'><img src='pics/gallery.png'
                        alt='gallery icon' style="width:90px;height:90px;"></a></li>
            <li class='aside-icons'><a class="icon-hover" id='icon-explore'><img src='pics/explore.png'
                        alt='explore icon' style="width:90px;height:90px;"></a></li>
        </ul>
        <div id='legend' class='absolute mt8 color-green-faint z4'>
            <div class='inline-block mb12 txt-m align-center mx12'>IUCN Protected Area Categories</div>
            <ul class='color-green-faint txt-xxs mx18 align-l py2'></ul>
        </div>
    </aside>

    <!-- chapter story -->
    <div id='features'>
        <section id='introduction' class='active'>
            <h1>SOUTH AMERICA</h1>
            <p>South America is one of the richest sub-continents in terms of cultural and biological diversity;
                including indigenous peoples with strong historical ties to the region's ecosystems.<br>Protected and
                conserved areas have long been a successful management tool to conserve biodiversity, and
                without them, the global loss of biodiversity would likely be even greater.</p>
            <small class='scroll quiet'>SCROLL &#x25BE;</small>
        </section>
        <section id='argentina'>
            <h2>ARGENTINA</h2>
            <span>
                <h3>IUCN MANAGEMENT CATEGORIES:</h3>
            </span><br>
            <li class='aside-icons text-center'><a class='text' id='arg-sta'><img src='pics/arg.png'
                        alt='argentina statistics'></a></li>
        </section>
        <section id='bolivia'>
            <h2>BOLIVIA</h2>
            <span>
                <h3>IUCN MANAGEMENT CATEGORIES:</h3>
            </span><br>
            <li class='aside-icons text-center'><a class='text' id='bol-sta'><img src='pics/bol.png'
                        alt='bolivia statistics'></a></li>
        </section>
        <section id='brazil'>
            <h2>BRAZIL</h2>
            <span>
                <h3>IUCN MANAGEMENT CATEGORIES:</h3>
            </span><br>
            <li class='aside-icons text-center'><a class='text' id='brz-sta'><img src='pics/brz.png'
                        alt='brazil statistics'></a></li>
        </section>
        <section id='chile'>
            <h2>CHILE</h2>
            <span>
                <h3>IUCN MANAGEMENT CATEGORIES:</h3>
            </span><br>
            <li class='aside-icons text-center'><a class='text' id='chi-sta'><img src='pics/chi.png'
                        alt='chile statistics'></a></li>
        </section>
        <section id='colombia'>
            <h2>COLOMBIA</h2>
            <span>
                <h3>IUCN MANAGEMENT CATEGORIES:</h3>
            </span><br>
            <li class='aside-icons text-center'><a class='text' id='col-sta'><img src='pics/col.png'
                        alt='colombia statistics'></a></li>
        </section>
        <section id='ecuador'>
            <h2>ECUADOR</h2>
            <span>
                <h3>IUCN MANAGEMENT CATEGORIES:</h3>
            </span><br>
            <li class='aside-icons text-center'><a class='text' id='ecu-sta'><img src='pics/ecu.png'
                        alt='ecuador statistics'></a></li>
        </section>
        <section id='french guiana'>
            <h2>FRENCH GUIANA</h2>
            <span>
                <h3>IUCN MANAGEMENT CATEGORIES:</h3>
            </span><br>
            <li class='aside-icons text-center'><a class='text' id='fgy-sta'><img src='pics/fgy.png'
                        alt='french guyana statistics'></a></li>
        </section>
        <section id='guyana'>
            <h2>GUYANA</h2>
            <span>
                <h3>IUCN MANAGEMENT CATEGORIES:</h3>
            </span><br>
            <li class='aside-icons text-center'><a class='text' id='guy-sta'><img src='pics/guy.png'
                        alt='guyana statistics'></a></li>
        </section>
        <section id='paraguay'>
            <h2>PARAGUAY</h2>
            <span>
                <h3>IUCN MANAGEMENT CATEGORIES:</h3>
            </span><br>
            <li class='aside-icons text-center'><a class='text' id='par-sta'><img src='pics/par.png'
                        alt='paraguay statistics'></a></li>
        </section>
        <section id='peru'>
            <h2>PERU</h2>
            <span>
                <h3>IUCN MANAGEMENT CATEGORIES:</h3>
            </span><br>
            <li class='aside-icons text-center'><a class='text' id='per-sta'><img src='pics/per.png'
                        alt='peru statistics'></a></li>
        </section>
        <section id='suriname'>
            <h2>SURINAME</h2>
            <span>
                <h3>IUCN MANAGEMENT CATEGORIES:</h3>
            </span><br>
            <li class='aside-icons text-center'><a class='text' id='sur-sta'><img src='pics/sur.png'
                        alt='suriname statistics'></a></li>
        </section>
        <section id='uruguay'>
            <h2>URUGUAY</h2>
            <span>
                <h3>IUCN MANAGEMENT CATEGORIES:</h3>
            </span><br>
            <li class='aside-icons text-center'><a class='text' id='uru-sta'><img src='pics/uru.png'
                        alt='uruguay statistics'></a></li>
        </section>
        <section id='venezuela'>
            <h2>VENEZUELA</h2>
            <span>
                <h3>IUCN MANAGEMENT CATEGORIES:</h3>
            </span><br>
            <li class='aside-icons text-center'><a class='text' id='vnz-sta'><img src='pics/vnz.png'
                        alt='venezuela statistics'></a></li>
        </section>
    </div>

    <!-- chapter gallery -->
    <div id='gallery'>
        <div class='row'>
            <div class='col-md-12 mt30'>
                <p class='title-gallery h5 font-weight-bold text-center mr24'>DISCOVER</p>
                <div class='text-gallery small text-justify mr24 ml10 mt24 px24 py2'>
                    <p>IUCN defines a protected area as a clearly defined geographical space, recognised, dedicated and
                        managed, through legal or other effective means, to achieve the long-term conservation of nature
                        with associated ecosytem services and cultural values.</p>
                </div>
                <p class='text-gallery-footer lead my-5 text-center mr24'>Click on the map markers to view<br>a specific
                    photograph.</p>
                <div class='ml24'>

                </div>
            </div>
        </div>
    </div>

    <!-- chapter explore -->
    <div id='explore'>
        <div class='row'>
            <div class='col-md-12 mt30'>
                <p class='title-explore h5 font-weight-bold text-center mr24'>EXPLORE</p>
                <div class='text-explore small text-justify mr24 ml10 mt24 px24 py2'>
                    <p>IUCN defines a protected area as a clearly defined geographical space, recognised, dedicated and
                        managed, through legal or other effective means, to achieve the long-term conservation of nature
                        with associated ecosytem services and cultural values.</p>
                </div>
                <p class='text-explore-footer lead my-5 text-center mr24'>Click on icons to
                    deselect layers.</p>
            </div>
        </div>
        <div class='ml24'>
            <div id='polygon'></div>
            <div id='point'></div>
        </div>
    </div>

    <!-- IUCN-modal -->
    <div id='iucn-modal' class='absolute top right bottom left scroll-auto z2 none animation--speed-1'>
        <div
            class='flex-child border border-gray-dark bg-gray-dark color-green-faint round relative w600 mx-auto mt120'>
            <button id='modal-closed' class='btn btn-gray-dark absolute top right mr6 mt6 px0 py0'>
                <svg class='icon btn-info link color-lighten50 txt-xl'>
                    <use xlink:href='#icon-close'></use>
                </svg>
            </button>
            <div class='px24 py24'>
                <div class='txt-m mb12 align-center'>PROTECTED AREA CATEGORIES</div>
                <div class='txt-s text-justify'>
                    IUCN protected area management categories classify protected areas according to their<strong>
                        management objectives.</strong>
                    <br><br><strong>Ia - Strict Nature Reserve:</strong> Strictly protected areas set aside
                    to protect biodiversity and also geological/geomorphical features.<br><strong>Ib - Wilderness
                        Area:</strong> Large protected areas that have retained their natural character without
                    permanent or significant human
                    habitation.<br><strong>II - National Park:</strong> Large natural or near natural areas set aside to
                    protect large-scale ecological
                    processes, species and ecosystems characteristic of the area.<br><strong>III - National Monument
                        or Feature:</strong> Protected areas set aside to protect a specific natural monument, landform,
                    sea mount, submarine cavern, geological or living features.<br><strong>IV - Habitat/Species
                        Management Area:</strong> Aim to protect
                    particular species or habitats.<br><strong>V - Protected Landscape/Seascape:</strong> A protected
                    area where the interaction of people and nature over time has produced an area of distinct character
                    with significant, ecological, biological, cultural and scenic value.<br><strong>VI - Protected Area
                        With Sustainable Use Of Natural Resources:</strong> Conserve ecosystems and habitats together
                    with associated
                    cultural values and traditional natural resource management systems.
                    <p class='text-right color-green-faint'>Data:</a>
                        <a target="_blank"
                            href="https://www.iucn.org/theme/protected-areas/about/protected-area-categories">IUCN
                            Protected Area Categories</a>
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- WDPA-modal -->
    <div id='wdpa-modal' class='absolute top right bottom left scroll-auto z2 none animation--speed-1'>
        <div
            class='flex-child border border-gray-dark bg-gray-dark color-green-faint round relative w600 mx-auto mt120'>
            <button id='modal-clos' class='btn btn-gray-dark absolute top right mr6 mt6 px0 py0'>
                <svg class='icon btn-info link color-lighten50 txt-xl'>
                    <use xlink:href='#icon-close'></use>
                </svg>
            </button>
            <div class='px24 py24'>
                <div class='txt-m mb12 align-center'>World Database on Protected Areas</div>
                <div class='txt-s text-justify'>
                    Protected area spatial data is collected in the form of boundary (polygon) wherever it is available,
                    or as a single latitude and longitude coordinate (point) data where boundary data is not available.
                    Boundary data for an individual protected area may be unavailable for a number of reasons such as
                    lack of capacity to map protected areas or confidentiality issues preventing public dissemination of
                    data.<br><br>It is important that both data types are used in the analysis as far as possible, point
                    datasets
                    accounted for 9% of all the records in the WDPA in January 2016, excluding them for any analysis
                    will likely underestimate the extent of protected areas globally.<br><br>The WDPA stores the IUCN
                    Protected Area Management Categories for each of the protected areas where
                    these categories are reported. The IUCN category is provided to the WDPA as part of the dataset, and
                    is not assigned by the WDPA Team. There are many sites (both polygons and points) for which an IUCN
                    mangement category have not been reported, have not been assigned, or are not applicable. Assigning
                    IUCN management categories to protected areas is not a mandatory requierement for countries when
                    submitting data. Because the IUCN management objectives, does not relate to a given designation
                    (e.g. National Park), but to its management objectives, and therefore categories have not been
                    reported may only mean that the country has not conducted a formal process to assign the categories
                    to their protected area network, not that these protected areas are not well managed or don’t have
                    management objectives in place.
                    <p class='text-right color-green-faint'>Data:</a>
                        <a target="_blank" href="http://pp-import-production.s3.amazonaws.com/WDPA_Manual_1_5.pdf">World
                            Database on Protected Areas User Manual</a>
                    </p>
                </div>
            </div>
        </div>
    </div>


    <script>
        mapboxgl.accessToken = 'pk.eyJ1IjoibWFob3JuIiwiYSI6ImNpbnV0enJ4ZTEyNG91YW0zNGF6bTlva2wifQ.7jRtxQoaV2PHlRD7fu6U-g';

        var map = new mapboxgl.Map({
            container: 'map',
            style: 'mapbox://styles/mahorn/cjvhdsr2b0ga81cmke0w0ef0p',
            center: [-65, -20],
            zoom: 2.6,
        });

        var colorAreas = {
            'Ia': '#505160',
            'Ib': '#68829e',
            'II': '#aebd38',
            'III': '#598234',
            'IV': '#003b46',
            'V': '#07575b',
            'VI': '#66a5ad',
            'Not Reported': '#c4dfe6',
            'Not Applicable': '#a2c523'
        }

        var code = {
            'World Heritage Site (natural or mixed)': '1',
            'UNESCO-MAB Biosphere Reserve': '1',
            'World Heritage Site (natural or mixed)': '1'
        }

        map.on('load', function () {

            d3.json('data/polygons.json')
                .then(function (data) {
                    polygonsMap(data);
                    addAboutModalUI();
                    addIucnModalUI();
                    addLegend(data);
                    updateMap(data);
                });

            function polygonsMap(data) {
                var geojson = topojson.feature(data, data.objects.merge_files_sim);

                map.addLayer({
                    'id': 'polygon',
                    'type': 'fill',
                    'source': {
                        'type': 'geojson',
                        'data': geojson
                    },
                    'paint': {
                        'fill-color': [
                            'match', ['get', 'IUCN_CAT'],
                            'Ia', '#505160',
                            'Ib', '#68829e',
                            'II', '#aebd38',
                            'III', '#598234',
                            'IV', '#003b46',
                            'V', '#07575b',
                            'VI', '#66a5ad',
                            'Not Reported', '#c4dfe6',
                            'Not Applicable', '#a2c523',
                            '#ccc'
                        ],
                        'fill-opacity': 0.2,
                    },
                });
                var popup = new mapboxgl.Popup({
                    closeButton: false,
                    closeOnClick: false
                });
                map.on('mousemove', 'polygon', function (e) {
                    var features = map.queryRenderedFeatures(e.lngLat);
                    map.getCanvas().style.cursor = 'pointer';
                    // map.flyTo({center: e.lngLat, zoom: 6});
                    popup.setLngLat(e.lngLat)
                        .setHTML(String(e.features[0].properties.NAME).toLocaleString())
                        .addTo(map)
                });
                map.on('mouseleave', 'polygon', function () {
                    map.getCanvas().style.cursor = '';
                    popup.remove();
                });

            }

            function addAboutModalUI() {
                var trigger = document.getElementById('about-trigger'),
                    modal = document.getElementById('about-modal'),
                    close = document.getElementById('modal-close');
                trigger.addEventListener('click', function () {
                    modal.classList.remove('none');
                });
                close.addEventListener('click', function () {
                    modal.classList.add('none');
                });
            }

            function addIucnModalUI() {
                var trigger = document.getElementById('about-iucn'),
                    modal = document.getElementById('iucn-modal'),
                    close = document.getElementById('modal-closed');
                trigger.addEventListener('click', function () {
                    modal.classList.remove('none');
                });
                close.addEventListener('click', function () {
                    modal.classList.add('none');
                });
            }

            function addLegend(data) {
                var geojson = topojson.feature(data, data.objects.merge_files_sim);
                var labelCodes = {},
                    code;
                geojson.features.forEach(function (feature) {
                    code = feature.properties.IUCN_CAT;
                    if (!labelCodes[code]) {
                        labelCodes[code] = feature.properties.IUCN_CAT;
                    }
                })
                var listItems = '';
                for (var code in colorAreas) {
                    listItems += "<li class='li h-full txt-m'><span class='w24 h18 fl mr12' style='background:" +
                        colorAreas[code] + "'></span>" + labelCodes[code] + "</li>"
                }
                d3.select("#legend ul").html(listItems);
                d3.select('#legend').classed('none', false);
            } //end of addLegend function

            d3.json('data/points.json')
                .then(function (data) {
                    pointsMap(data);
                    addWdpaModalUI();
                });

            function pointsMap(data) {
                // console.log(data);
                map.addLayer({
                    'id': 'points',
                    'type': 'circle',
                    'source': {
                        'type': 'geojson',
                        'data': data,
                        'cluster': true,
                        'clusterMaxZoom': 4, // Max zoom to cluster points on
                        'clusterRadius': 2 // Radius of each cluster when clustering points (defaults to 50)
                    },
                    'paint': {
                        'circle-color': [
                            'match', ['get', 'IUCN_CAT'],
                            'Ia', '#505160',
                            'Ib', '#68829e',
                            'II', '#aebd38',
                            'III', '#598234',
                            'IV', '#003b46',
                            'V', '#07575b',
                            'VI', '#66a5ad',
                            'Not Reported', '#c4dfe6',
                            'Not Applicable', '#a2c523',
                            '#ccc'
                        ],
                        'circle-radius': 4,
                        'circle-opacity': .6,
                    },
                });

                var popup = new mapboxgl.Popup({
                    closeButton: false,
                    closeOnClick: false
                });

                map.on('mousemove', 'points', function (e) {
                    var features = map.queryRenderedFeatures(e.lngLat);
                    map.getCanvas().style.cursor = 'pointer';
                    popup.setLngLat(e.lngLat)
                        .setHTML(String(e.features[0].properties.NAME).toLocaleString())
                        .addTo(map)
                });
                map.on('mouseleave', 'points', function () {
                    map.getCanvas().style.cursor = '';
                    popup.remove();
                });

                data.features.forEach(function (marker) {
                    var el = document.createElement('div');
                    el.className = 'marker';
                    new mapboxgl.Marker(el)
                        .setLngLat(marker.geometry.coordinates)
                        .setPopup(new mapboxgl.Popup({
                            offset: 25
                        })
                            .setHTML('<h3>' + marker.properties.NAME + '</h3><p>' + marker.properties.DESIG_ENG + '</p><p>' + marker.properties.IUCN_CAT + '</p>'))
                        .addTo(map);
                });

            } //end of function pointsMap

            function addWdpaModalUI() {
                var trigger = document.getElementById('about-wdpa'),
                    modal = document.getElementById('wdpa-modal'),
                    close = document.getElementById('modal-clos');
                trigger.addEventListener('click', function () {
                    modal.classList.remove('none');
                });
                close.addEventListener('click', function () {
                    modal.classList.add('none');
                });
            } //end of function addWdpaModalUI

        }); //end of map.on('load')

        // STORY CHAPTER //
        var currentSelected = $('#icon-story').click(function () {
            $('#features').toggle();
            map.flyTo({
                center: [-80, -20],
                zoom: 2.6,
                bearing: 0,
                pitch: 0,
                speed: 0.4,
                curve: 2,
                easing: function (t) {
                    return t;
                }
            });
        });

        var chapters = {
            'introduction': {
                center: [-75, -18],
                zoom: 2.7,
            },
            'argentina': {
                center: [-70.6167, -40.4161],
                zoom: 3.2,
            },
            'bolivia': {
                center: [-66.5887, -16.2902],
                zoom: 4.8,
            },
            'brazil': {
                center: [-61.0253, -12.2350],
                zoom: 3.5,
            },
            'chile': {
                center: [-76.5430, -38.4161],
                zoom: 3.2,
            },
            'colombia': {
                center: [-75.2973, 4.2709],
                zoom: 4.7,
            },
            'ecuador': {
                center: [-86.3834, -2.8312],
                zoom: 4.7
            },
            'french guiana': {
                center: [-54.1258, 3.9339],
                zoom: 6.5,
            },
            'guyana': {
                center: [-60.9302, 4.5904],
                zoom: 5.7,
            },
            'paraguay': {
                center: [-59.9438, -23.4425],
                zoom: 5.3,
            },
            'peru': {
                center: [-77.0152, -9.1900],
                zoom: 4.5,
            },
            'suriname': {
                center: [-56.9302, 3.8904],
                zoom: 6.2,
            },
            'uruguay': {
                center: [-57.2167, -32.4161],
                zoom: 6,
            },
            'venezuela': {
                center: [-68.5897, 6.4238],
                zoom: 5,
            }
        };

        window.onscroll = function () {
            var chapterNames = Object.keys(chapters);
            for (var i = 0; i < chapterNames.length; i++) {
                var chapterName = chapterNames[i];
                if (isElementOnScreen(chapterName)) {
                    setActiveChapter(chapterName);
                    break;
                }
            }
        };

        var activeChapterName = 'introduction';
        function setActiveChapter(chapterName) {
            if (chapterName === activeChapterName) return;
            map.flyTo(chapters[chapterName]);
            document.getElementById(chapterName).setAttribute('class', 'active');
            document.getElementById(activeChapterName).setAttribute('class', '');
            activeChapterName = chapterName;
        }

        function isElementOnScreen(id) {
            var element = document.getElementById(id);
            var bounds = element.getBoundingClientRect();
            return bounds.top < window.innerHeight && bounds.top > 0;
        }

        // GALLERY CHAPTER //
        var endClicked = $('#icon-gallery').on('click', function () {
            $('#gallery').toggle(
                map.fitBounds([-75, -5, -5, -20], {
                    zoom: 2.6
                })
            );
        });
        $('#icon-gallery').off('click', endClicked);

        function updateMap(code) {
            $('#am').on('click', function (code) {
                map.setPaintProperty('polygon', 'fill-opacity', [
                    'match', ['get', 'DESIG_ENG'],
                    code, 1,
                    0
                ])
            });
        }//end function updateMap


        //     if (code === 'World Heritage Site (natural or mixed)') {
        //         map.setPaintProperty('polygon', 'fill-opacity', [
        //             'match', ['get', 'DESIG_ENG'],
        //             'World Heritage Site (natural or mixed)', 1,
        //             0
        //         ]);
        //     } else if (code === 'UNESCO-MAB Biosphere Reserve') {
        //         map.setPaintProperty('polygon', 'fill-opacity', [
        //             'match', ['get', 'DESIG_ENG'],
        //             'UNESCO-MAB Biosphere Reserve', 1,
        //             0
        //         ]);
        //     } else if (code === 'Strict Nature Reserve') {
        //         map.setPaintProperty('polygon', 'fill-opacity', [
        //             'match', ['get', 'DESIG_ENG'],
        //             'Strict Nature Reserve', 1,
        //             0
        //         ]);
        //     }
        // });

        // }//end function updateMap


        // EXPLORE CHAPTER //
        var endClicked = $('#icon-explore').on('click', function () {
            $('#explore').toggle(
                map.fitBounds([-75, -10, -25, -15], {
                    zoom: 2.6
                })
            );
        });
        $('#icon-explore').off('click', endClicked);

        var toggleableLayerIds = ['polygon'];
        for (var i = 0; i < toggleableLayerIds.length; i++) {
            var id = toggleableLayerIds[i];
            var img = document.createElement('img');
            img.src = 'pics/polygon.png'
            img.className = 'active'
            img.id = 'picture'
            img.textContent = id
            img.onclick = function (e) {
                var clickedLayer = this.textContent;
                e.preventDefault();
                e.stopPropagation();
                var visibility = map.getLayoutProperty(clickedLayer, 'visibility');
                if (visibility === 'visible') {
                    map.setLayoutProperty(clickedLayer, 'visibility', 'none');
                    this.className = '';
                } else {
                    this.className = 'active';
                    map.setLayoutProperty(clickedLayer, 'visibility', 'visible');
                }
            };
            var layers = document.getElementById('polygon');
            layers.appendChild(img)
        }
        $(polygon).hover(
            function () {
                $(this).append($("<span>Polygons Layer</span>"));
            },
            function () {
                $(this).find("span:last").remove();
            }
        );

        var toggleableLayerIds = ['points'];
        for (var i = 0; i < toggleableLayerIds.length; i++) {
            var id = toggleableLayerIds[i];
            var img = document.createElement('img');
            img.src = 'pics/point.png'
            img.className = 'active'
            img.id = 'picture'
            img.textContent = id
            img.onclick = function (e) {
                var clickedLayer = this.textContent;
                e.preventDefault();
                e.stopPropagation();
                var visibility = map.getLayoutProperty(clickedLayer, 'visibility');
                if (visibility === 'visible') {
                    map.setLayoutProperty(clickedLayer, 'visibility', 'none');
                    this.className = '';
                } else {
                    this.className = 'active';
                    map.setLayoutProperty(clickedLayer, 'visibility', 'visible');
                }
            };
            var layers = document.getElementById('point');
            layers.appendChild(img)
        }
        $(point).hover(
            function () {
                $(this).append($("<span>Points Layer</span>"));
            },
            function () {
                $(this).find("span:last").remove();
            }
        );

        // resets map to initial latlng when click on CONSERVATION //
        document.getElementById('about-icon').addEventListener('click', function () {
            map.flyTo({
                center: [-65, -20],
                zoom: 2.6,
            });
            var currentSelected = document.querySelector('.selected');
            if (currentSelected) {
                currentSelected.classList.remove('selected');
            }
        });

    </script>

</body>

</html