<!DOCTYPE html>
<html lang="en">

<head>
    <title>storymap</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!--add required stylesheets-->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.45.0/mapbox-gl.css' rel='stylesheet' />
    <link href='https://api.mapbox.com/mapbox.js/v3.2.0/mapbox.css' rel='stylesheet' />

    <!--leaflet css-->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.4.0/leaflet.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.5.2/animate.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons"> -->

    <!--Font-->
    <!-- <link href="https://fonts.googleapis.com/css?family=Cairo" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="../../dist/storymap.2.5.css"> -->

    <!--add required libraries-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.4.0/leaflet.js"></script>

    <!--jquery and Popper-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js"></script>

    <!--boostrap-->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>

    <!--leaflet.ajax for asynchronously adding geojson data-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-ajax/2.1.0/leaflet.ajax.min.js"></script>

    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.45.0/mapbox-gl.js'></script>
    <script src='https://api.mapbox.com/mapbox.js/v3.2.0/mapbox.js'></script>
    <script src="https://d3js.org/d3-fetch.v1.min.js"></script>
    <script src="https://unpkg.com/topojson@3"></script>

    <!-- story map plugin-->
    <!-- <script src="../../dist/storymap.2.5.js"></script> --> 

    <style>

        body {
            margin: 0;
            padding: 0;
        }

        #map {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 100%;
        }


        article {
            position: absolute;
            top: 20px;
            right: 0;
            bottom: 20px;
            left: 30%;
            overflow: auto;
        }

        .quiet {
            color: rgba(0, 0, 0, 0.5);
        }

        .scroll {
            display: block;
            text-align: center;
        }

        .sections {
            background: rgba(255, 255, 255, 0.5);
            width: 240px;
        }

        section {
            padding: 20px;
            color: rgba(0, 0, 0, 0.5);
            -webkit-transition: background 500ms, color 500ms;
            transition: background 500ms, color 500ms;
        }

        section.active {
            background: #fff;
            color: #404040;
        }
    </style>

</head>

<body>

    <div id="map"></div>

    <article id='narrative'>
        <div class='sections prose'>
            <section id='cover' class='cover active'>
                <h2>The Adventure of the Bruce-Partington Plans</h2>
                <p>by Sir Arthur Conan Doyle</p>
                <small class='scroll quiet'>Scroll &#x25BE;</small>
            </section>
            <section id='baker'>
                <h3>221b Baker St.</h3>
                <p>November 1895. London is shrouded in fog and Sherlock Holmes and Watson pass time restlessly awaiting
                    a new case. "The London criminal is certainly a dull fellow," Sherlock bemoans. "There have been
                    numerous petty thefts," Watson offers in response. Just then a telegram arrives from Sherlock's
                    brother Mycroft with a mysterious case.</p>
            </section>
            <section id='aldgate'>
                <h3>Aldgate Station</h3>
                <p>Arthur Cadogan West was found dead, head crushed in on train tracks at Aldgate Station at 6AM Tuesday
                    morning. West worked at Woolwich Arsenal on the Bruce-Partington submarine, a secret military
                    project. Plans for the submarine had been stolen and seven of the ten missing papers were found in
                    West's possession. Mycroft implores Sherlock to take the case and recover the three missing papers.
                </p>
            </section>
            <section id='london-bridge'>
                <h3>London Bridge</h3>
                <p>Holmes and Watson's investigations take them across London. Sherlock deduces that West was murdered
                    elsewhere, then moved to Aldgate Station to create the illusion that he was crushed on the tracks by
                    a train. On their way to Woolwich Sherlock dispatches a telegram to Mycroft at London Bridge: "Send
                    list of all foreign spies known to be in England, with full address."</p>
            </section>
            <section id='woolwich'>
                <h3>Woolwich Arsenal</h3>
                <p>While investigating at Woolwich Arsenal Sherlock learns that West did not have the three
                    keys&mdash;door, office, and safe&mdash;necessary to steal the papers. The train station clerk
                    mentions seeing an agitated West boarding the 8:15 train to London Bridge. Sherlock suspects West of
                    following someone who had access to the Woolwich chief's keyring with all three keys.</p>
            </section>
            <section id='gloucester'>
                <h3>Gloucester Road</h3>
                <p>Mycroft responds to Sherlock's telegram and mentions several spies. Hugo Oberstein of 13 Caulfield
                    Gardens catches Sherlock's eye. He heads to the nearby Gloucester Road station to investigate and
                    learns that the windows of Caulfield Gardens open over rail tracks where trains stop frequently.</p>
            </section>
            <section id='caulfield-gardens'>
                <h3>13 Caulfield Gardens</h3>
                <p>Holmes deduces that the murderer placed West atop a stopped train at Caulfield Gardens. The train
                    traveled to Aldgate Station before West's body finally toppled off. Backtracking to the criminal's
                    apartment, Holmes finds a series of classified ads from <em>The Daily Telegraph</em> stashed away.
                    All are under the name Pierrot: "Monday night after nine. Two taps. Only ourselves. Do not be so
                    suspicious. Payment in hard cash when goods delivered."</p>
            </section>
            <section id='telegraph'>
                <h3>The Daily Telegraph</h3>
                <p>Holmes and Watson head to The Daily Telegraph and place an ad to draw out the criminal. It reads:
                    "To-night. Same hour. Same place. Two taps. Most vitally important. Your own safety at stake.
                    Pierrot." The trap works and Holmes catches the criminal: Colonel Valentine Walter, the brother of
                    Woolwich Arsenal's chief. He confesses to working for Hugo Oberstein to obtain the submarine plans
                    in order to pay off his debts.</p>
            </section>
            <section id='charing-cross'>
                <h3>Charing Cross Hotel</h3>
                <p>Walter writes to Oberstein and convinces him to meet in the smoking room of the Charing Cross Hotel
                    where he promises additional plans for the submarine in exchange for money. The plan works and
                    Holmes and Watson catch both criminals.</p>
                <small class='colophon'>
                    Adapted from <a href='http://www.gutenberg.org/files/2346/2346-h/2346-h.htm'>Project Gutenberg</a>
                </small>
            </section>
        </div>
    </article>

    <script>

        mapboxgl.accessToken = 'pk.eyJ1IjoibWFob3JuIiwiYSI6ImNpbnV0enJ4ZTEyNG91YW0zNGF6bTlva2wifQ.7jRtxQoaV2PHlRD7fu6U-g';

        var map = new mapboxgl.Map({
            container: 'map', // container id
            style: 'mapbox://styles/mapbox/light-v9', // stylesheet location
            center: [-65, -25], // starting position [lng, lat]
            zoom: 2.2 // starting zoom
        });

        var oceanOptions = {
            fillOpacity: 0,
            color: '#040d18',
            opacity: 1,
            weight: 3
        };

        var colorCodes = {

            0: "#4d648d",
            200: "#546d9a",
            1000: "#5c76a6",
            2000: "#6881ad",
            3000: "#758bb4",
            4000: "#8296bb",
            5000: "#8ea1c1",
            6000: "#9babc8",
            7000: "#a8b6cf",
            8000: "#b4c1d6",
            9000: "#c1cbdd",
            10000: "#ced6e4"
        }

        // when the map is done loading
        map.on('load', function () {

            // request our GEOJSON data
            d3.json('data/ocean.json')
                .then(function (data) {
                    console.log(data);
                    oceanMap(data);
                });

            function oceanMap(data) {
                var geojson = topojson.feature(data, data.objects.ocean);
                console.log(geojson);

                map.addLayer({
                    'id': 'ocean',
                    'type': 'fill',
                    'source': {
                        'type': 'geojson',
                        'data': geojson// use the data as the data source
                    },
                    'paint': {
                        "fill-color": [
                            "match", // match the numbers below to the depth
                            ["number", ["get", "depth"]],
                            0, colorCodes[0],
                            200, colorCodes[200],
                            1000, colorCodes[1000],
                            2000, colorCodes[2000],
                            3000, colorCodes[3000],
                            4000, colorCodes[4000],
                            5000, colorCodes[5000],
                            6000, colorCodes[6000],
                            7000, colorCodes[7000],
                            8000, colorCodes[8000],
                            9000, colorCodes[9000],
                            10000, colorCodes[10000],
                            "#000000" // default for no match
                        ],
                        "fill-opacity": 0.18,
                        "fill-outline-color": "hsla(180, 100%, 50%, 0.3)"
                    }
                });
            }
        });

        // var places = {
        //     type: 'FeatureCollection', features: [
        //         {
        //             geometry: { type: "Point", coordinates: [-0.12960000, 51.50110000] },
        //             properties: { id: "cover", zoom: 9 }, type: 'Feature'
        //         },
        //         {
        //             geometry: { type: "Point", coordinates: [-0.15591514, 51.51830379] },
        //             properties: { id: "baker" }, type: 'Feature'
        //         },
        //         {
        //             geometry: { type: "Point", coordinates: [-0.07571203, 51.51424049] },
        //             properties: { id: "aldgate" }, type: 'Feature'
        //         },
        //         {
        //             geometry: { type: "Point", coordinates: [-0.08533793, 51.50438536] },
        //             properties: { id: "london-bridge" }, type: 'Feature'
        //         },
        //         {
        //             geometry: { type: "Point", coordinates: [0.05991101, 51.48752939] },
        //             properties: { id: "woolwich" }, type: 'Feature'
        //         },
        //         {
        //             geometry: { type: "Point", coordinates: [-0.18335806, 51.49439521] },
        //             properties: { id: "gloucester" }, type: 'Feature'
        //         },
        //         {
        //             geometry: { type: "Point", coordinates: [-0.19684993, 51.5033856] },
        //             properties: { id: "caulfield-gardens" }, type: 'Feature'
        //         },
        //         {
        //             geometry: { type: "Point", coordinates: [-0.10669358, 51.51433123] },
        //             properties: { id: "telegraph" }, type: 'Feature'
        //         },
        //         {
        //             geometry: { type: "Point", coordinates: [-0.12416858, 51.50779757] },
        //             properties: { id: "charing-cross" }, type: 'Feature'
        //         }
        //     ]
        // };

        // var map = L.mapbox.map('map', null, {
        //     zoomControl: false
        // })
        //     .setView([51.507, -0.1282], 8)
        //     .addLayer(L.mapbox.styleLayer('mapbox://styles/mapbox/streets-v11'));

        // var placesLayer = L.mapbox.featureLayer(places)
        //     .addTo(map);

        // Ahead of time, select the elements we'll need -
        // the narrative container and the individual sections
        // var narrative = document.getElementById('narrative'),
        //     sections = narrative.getElementsByTagName('section'),
        //     currentId = '';

        // setId('cover');

        // function setId(newId) {
        //     // If the ID hasn't actually changed, don't do anything
        //     if (newId === currentId) return;
        //     // Otherwise, iterate through layers, setting the current
        //     // marker to a different color and zooming to it.
        //     placesLayer.eachLayer(function (layer) {
        //         if (layer.feature.properties.id === newId) {
        //             map.setView(layer.getLatLng(), layer.feature.properties.zoom || 14);
        //             layer.setIcon(L.mapbox.marker.icon({
        //                 'marker-color': '#a8f'
        //             }));
        //         } else {
        //             layer.setIcon(L.mapbox.marker.icon({
        //                 'marker-color': '#404040'
        //             }));
        //         }
        //     });
        //     // highlight the current section
        //     for (var i = 0; i < sections.length; i++) {
        //         sections[i].className = sections[i].id === newId ? 'active' : '';
        //     }
        //     // And then set the new id as the current one,
        //     // so that we know to do nothing at the beginning
        //     // of this function if it hasn't changed between calls
        //     currentId = newId;
        // }

        // // If you were to do this for real, you would want to use
        // // something like underscore's _.debounce function to prevent this
        // // call from firing constantly.
        // narrative.onscroll = function (e) {
        //     var narrativeHeight = narrative.offsetHeight;
        //     var newId = currentId;
        //     // Find the section that's currently scrolled-to.
        //     // We iterate backwards here so that we find the topmost one.
        //     for (var i = sections.length - 1; i >= 0; i--) {
        //         var rect = sections[i].getBoundingClientRect();
        //         if (rect.top >= 0 && rect.top <= narrativeHeight) {
        //             newId = sections[i].id;
        //         }
        //     };
        //     setId(newId);
        // };



    </script>
</body>

</html>