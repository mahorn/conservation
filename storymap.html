<!DOCTYPE html>
<html lang="en">

<head>
    <title>storymap</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!--add required stylesheets-->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.45.0/mapbox-gl.css' rel='stylesheet' />

    <!--leaflet css-->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.4.0/leaflet.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.5.2/animate.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">

    <!--add favicon for the web page-->
    <link rel="shortcut icon" href="../../img/favicon.ico" type="image/x-icon">

    <!--Font-->
    <link href="https://fonts.googleapis.com/css?family=Cairo" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="../../dist/storymap.2.5.css">

    <!--add required libraries-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.4.0/leaflet.js"></script>

    <!--jquery and Popper-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js"></script>

    <!--boostrap-->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>

    <!--leaflet.ajax for asynchronously adding geojson data-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-ajax/2.1.0/leaflet.ajax.min.js"></script>

    <!--story map plugin-->
    <script src="../../dist/storymap.2.5.js"></script>

    <style>
        html {
            height: 100%;
        }

        body {
            height: 100%;
            font-family: Cairo, sans-serif;
            font-size: 14px;
        }

        .cesium-viewer-cesiumWidgetContainer {
            position: fixed;
            top: 0;
            bottom: 0;
            right: 0;
            z-index: 1000;
            display: block;
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
        }

        h1 {
            margin-top: 25%;
            font-family: Cairo, sans-serif;
            color: rgba(255, 255, 255, 0.95);
            font-size: 4vw;
            text-shadow: 0 0 6px rgba(0, 0, 0, .95);
        }

        .storymap-trigger {
            left: 0;
            margin-top: -10px;
            position: fixed;
            /* top: 33.3333%; */
            width: 3px;
            height: 3px;
        }

        .storymap-story {
            padding-right: 10px;
            padding-left: 10px;
            padding-bottom: 1000px;
            display: block;
            z-index: 1000;
            background-color: rgba(238, 238, 238, 0);



        }

        .storymap-map {
            position: fixed;
            top: 0;
            bottom: 0;
            right: 0;
            min-width: 100%;
            min-height: 100%;
            z-index: 900;
            display: block;
            overflow-x: hidden;
            overflow-y: hidden;
            background-color: #f5f5f5;
        }

        @media (min-width: 768px) {
            .storymap-story {
                width: 600px;
            }

        }

        @media (min-width: 0px) and (max-width: 767px) {

            .storymap-story {
                width: 100%;
            }

            .storymap-map {
                position: fixed;
                top: 0;
                bottom: 0;
                right: 0;
                min-width: 100%;
                min-height: 100%;
                display: block;
                overflow-x: hidden;
                overflow-y: hidden;
                background-color: #f5f5f5;
            }

            .viewing {
                background: rgba(221, 221, 221, 0.3);
            }

            .storymap-scroll-down {
                display: none;
            }

        }

        section {

            padding: 5px 15px 10px 15px;
            margin: 5px;
            border-radius: 5px;
            background: #eee;
            opacity: 0;
            /*color: #111111;*/
        }

        .viewing {
            color: #1c1c1c;
            box-shadow: 0 2px 4px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.2);
            opacity: 0.8;
            filter: alpha(opacity=80);
            -moz-opacity: 0.8;
        }

        .fullscreen {
            position: fixed;
            top: 0;
            bottom: 0;
            right: 0;
            border-radius: 0;
            min-height: 100%;
            min-width: 100%;
            /*pointer-events: none;*/
            display: block;
        }

        .canvas-center {
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        /*transparent the story panel but still able to trigger events*/

        .section-opacity {
            opacity: 1;
            filter: alpha(opacity=100);
            opacity: 1;
            -moz-opacity: 1;
            width: 0;
            padding: 0 0 0 0;
        }

        .storymap-loader {
            color: rgba(255, 255, 255, 0.9);
            text-shadow: 0 1px 1px rgba(197, 197, 197, 0.95);
            position: fixed;
            top: 45%;
            left: 50%;
            font-size: 50px;
            z-index: 1003;
            animation: spin 1.2s linear infinite;

        }

        .storymap-screenloader {
            position: fixed;
            top: 0;
            left: 0;
            width: 400%;
            height: 400%;
            background: rgb(238, 238, 238);
            transform: translate(-50%, -50%);
            -ms-transform: translate(-50%, -50%);
            display: block;
            z-index: 1002;
        }

        @-webkit-keyframes spin {
            0% {
                -webkit-transform: rotate(0deg);
            }

            100% {
                -webkit-transform: rotate(360deg);
            }
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .storymap-navwidget {
            position: fixed;
            top: 40%;
            left: 0;
            z-index: 1005;
            font-size: 16px;
            color: rgba(63, 63, 63, 0.3);
            background: rgba(115, 115, 115, 0.2);
            border-radius: 2px;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);

            opacity: 0;
            filter: alpha(opacity=0);
            -moz-opacity: 0;
        }

        .storymap-navwidget>li {
            position: relative;
            display: block !important;
            cursor: pointer;

        }

        .storymap-navwidget li a {
            padding: 6px;
            -webkit-text-stroke: 1px rgba(35, 35, 35, 0.7);
            text-shadow: 0 1px 2px rgba(81, 81, 81, 0.95);
        }

        .storymap-navwidget li a:visited,
        .storymap-navwidget li a:active,
        .storymap-navwidget li a:link {
            color: rgba(62, 62, 62, 0.6);
            text-decoration: none;
        }

        .storymap-navwidget li a:hover {
            color: rgba(218, 218, 218, 0.7);
            text-decoration: none;
        }

        /*support video in IE 8 and 9*/

        video {
            display: block;
        }

        .storymap-scroll-down {
            cursor: pointer;
            z-index: 1001;
            font-size: 4vw !important;
            color: rgba(255, 255, 255, 0.9);
            text-shadow: 0 1px 1px rgba(197, 197, 197, 0.95);
        }

        .storymap-scroll-down:hover {
            color: rgba(200, 200, 200, 0.9);
            text-shadow: 0 1px 1px rgba(150, 150, 150, 0.95);
        }

        .storymap-attribution {
            font-family: Cairo, sans-serif;
            background: rgba(255, 255, 255, 0.6) !important;
            box-shadow: 0 0 2px rgba(0, 0, 0, 0.2);
            border-radius: 2px;
        }

        .storymap-attribution a:visited,
        .storymap-attribution a:active,
        .storymap-attribution a:link {
            color: #333333;
            text-decoration: none;
        }

        .storymap-legend {
            position: fixed;
            line-height: 16px;
            width: 100px;
            z-index: 1000;
            right: 20px;
            top: 30px;
            display: none;
            color: #333333;
            font-family: Cairo, sans-serif;
            padding: 6px 8px;
            background: rgba(255, 255, 255, 0.5);
            box-shadow: 0 2px 4px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.2);
            border-radius: 2px;
        }

        .storymap-legend i {
            width: 16px;
            height: 16px;
            float: left;
            margin-right: 8px;
            opacity: 1;
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.2), 0 1px 2px 0 rgba(0, 0, 0, 0.2);
        }

        .storymap-legend img {
            width: 16px;
            height: 16px;
            margin-right: 3px;
            float: left;
        }

        .storymap-legend p {
            font-size: 12px;
            line-height: 16px;
            margin: 0;
        }

        .storymap-progressline {
            position: fixed;
            top: 0;
            left: 0;
            width: 0;
            height: 3px;
            z-index: 1030;
            background: rgba(255, 30, 0, 0.80);
            box-shadow: 0 0 2px rgba(98, 16, 0, 0.9);
        }

        nav {
            height: 34px !important;
            z-index: 1001;
        }

        nav .navbar-brand {
            padding-top: 2px !important;
            padding-bottom: 0 !important;
            height: 28px;
        }

        .btn {
            position: fixed;
            cursor: pointer;
            font-size: 18px;
            padding-bottom: 5px;
            margin-bottom: 5px;
            color: rgba(169, 169, 169, 0.8);
            z-index: 1005;
            top: 20px;
            left: 5px;
        }

        .btn:hover {
            color: rgba(0, 117, 255, 0.6);
            text-decoration: none;
        }
    </style>

</head>

<body>
    <div id="storymap" class="container-fluid">
        <div class="row">
            <div class="col-sm-6 col-md-8 storymap-map"></div>
            <div class="col-sm-6 col-md-4 storymap-story">

                <section data-scene="scene1">
                    <h2>scene 1</h2>
                </section>

                <section data-scene="scene2">
                    <h2>scene 2</h2>
                </section>

                <section data-scene="scene3">
                    <h2>scene 3</h2>
                </section>
            </div>
        </div>
    </div>
    <script>

        var layers = {
            layer1: {
                layer: L.tileLayer('http://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}'),
                legend: '<i style="background: black; opacity: 0.5"></i><p><b>legend 1</b></p>'
            },
            layer2: {
                layer: L.geoJson.ajax('http://mapious.ceoas.oregonstate.edu/geoserver/mapious/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=ore_counties&outputFormat=application%2Fjson', {
                    color: 'orange',
                    weight: 5
                }),
                legend: '<i style="background: orange; opacity: 0.5"></i><p><b>legend 2</b></p>'
            },
            layer3: {
                layer: L.tileLayer('http://cartodb-basemaps-{s}.global.ssl.fastly.net/light_all/{z}/{x}/{y}.png')
            }
        };

        var scenes = {
            scene1: { lat: 44, lng: -123.5, zoom: 7, layers: [layers.layer2], name: "scene 1" },
            scene2: { lat: 44.5701158, lng: -123.2949388, zoom: 10, layers: [layers.layer2], name: "scene 2" },
            scene3: { lat: 44.5701158, lng: -123.2949388, zoom: 12, layers: [layers.layer1, layers.layer2], name: "scene 3" }
        };

        $('#storymap').storymap({
            scenes: scenes,
            layers: layers,
            baselayer: layers.layer3,
            legend: true,
            loader: true,
            flyto: false,
            credits: "Build with <i class='material-icons' style='color: red; font-size: 10px;'>favorite</i> from John Doe",
            scalebar: true,
            scrolldown: true,
            progressline: true,
            navwidget: true,
            createMap: function () {
                var map = L.map($(".storymap-map")[0], { zoomControl: false }).setView([44, -120], 7);
                basemap = this.baselayer.layer.addTo(map);
                return map;
            }
        });

        (function ($) {

            $.fn.autoplay = function (options) {
                var defaults = {
                    selector: 'section',
                    stepperSelector: '.storymap-scroll-down'
                };

                var settings = $.extend(defaults, options);


                var i = 0;
                var sceneNum = $(settings.selector).length - 1;
                setInterval(function () {
                    if (i < sceneNum) {
                        if ($('.storymap-navbar').length !== 0) {
                            window.scrollBy(0, $($(settings.selector)[i + 1]).offset().top - $(window).scrollTop() - $('.storymap-navbar').height() - 30);
                        } else {
                            window.scrollBy(0, $($(settings.selector)[i + 1]).offset().top - $(window).scrollTop() - 10);
                        }
                        i += 1;
                    }
                }, 3000);
            };

            $.fn.storymap = function (options) {

                var defaults = {
                    selector: '[data-scene]',
                    triggerpos: '30%',
                    navbar: false,
                    navwidget: false,
                    legend: true,
                    loader: true,
                    flyto: false,
                    scalebar: false,
                    scrolldown: true,
                    progressline: true,
                    mapinteraction: false,
                    createMap: function () {
                        var map = L.map($('.storymap-map')[0], { zoomControl: false }).setView([44, -120], 7);
                        // L.tileLayer('http://cartodb-basemaps-{s}.global.ssl.fastly.net/light_all/{z}/{x}/{y}@2x.png').addTo(map);
                        return map;
                    }
                };

                var settings = $.extend(defaults, options);

                if (typeof (L) === 'undefined') {
                    throw new Error('Storymap requires Leaflet.');
                }

                function getDistanceToTop(elem, top) {

                    var docViewTop = $(window).scrollTop();

                    var elemTop = $(elem).offset().top;

                    var dist = elemTop - docViewTop;

                    var d = top - dist;

                    if (d < 0) {
                        return $(document).height();
                    }
                    return d;
                }

                function highlightTopPara(sections, top) {

                    var distances = $.map(sections, function (element) {
                        var dist = getDistanceToTop(element, top);
                        return {
                            el: $(element),
                            distance: dist
                        };
                    });

                    function findMin(pre, cur) {
                        if (pre.distance > cur.distance) {
                            return cur;
                        } else {
                            return pre;
                        }
                    }

                    var closest = distances.reduce(findMin);

                    $.each(sections, function (key, element) {

                        var section = $(element);
                        if (section[0] !== closest.el[0]) {
                            section.trigger('notviewing');
                        }

                        // if (section.height() <= $(window).height() * 0.33 ) {
                        //     section.height($(window).height() * 0.33)
                        // }


                        if (section.height() <= $(window).height() * 0.33 && section.has("img").length === 0) {
                            section.height($(window).height() * 0.33)
                        }

                    });

                    if (!closest.el.hasClass('viewing')) {
                        closest.el.trigger('viewing');
                    }
                }

                function watchHighlight(element, searchfor, top) {

                    var sections = element.find(searchfor);
                    highlightTopPara(sections, top);

                    $(window).scroll(function () {
                        highlightTopPara(sections, top);
                    });


                }


                //support video for IE 8 and 9.
                document.createElement('video');

                var makeStoryMap = function (element, scenes) {

                    $(element).addClass("storymap");
                    var topElem = $('<div class="storymap-trigger"></div>')
                        .css('top', settings.triggerpos);
                    $('body').append(topElem);
                    var top = topElem.offset().top - $(window).scrollTop();
                    var searchfor = settings.selector;
                    var sections = $(element).find(searchfor);
                    var map = settings.createMap();


                    var currentLayerGroup = L.layerGroup().addTo(map);
                    var nav = $("nav");


                    if (settings.baselayer) {
                        // add an base map, which can be either OSM, mapbox, tilelayer, wmslayer or those designed by yourself.
                        settings.baselayer.layer.addTo(map);
                    }

                    if (settings.legend) {
                        $(".storymap").append("<div class='storymap-legend' />")
                    }

                    if (settings.scrolldown) {
                        $(".storymap").append("<div class='zoomIn infinite material-icons d-flex fixed-bottom mb-5 storymap-scroll-down'>keyboard_arrow_down</div>")
                    }

                    if (settings.scalebar) {
                        L.control.scale({
                            position: "bottomright",
                            metric: false
                        }).addTo(map);
                    }

                    if (settings.progressline) {
                        $(".storymap").append("<div class='storymap-progressline' />")

                    }

                    if (settings.navwidget) {
                        $(".storymap").append("<div class='storymap-navwidget text-center'/>")

                    }

                    if (settings.loader) {
                        $(".storymap").append("<div class='material-icons storymap-loader'> autorenew </div>")

                    }


                    $(".storymap-map .leaflet-control-attribution")
                        .addClass("storymap-attribution")
                        .html("<a href='https://github.com/jakobzhao/storymap'><img src='http://jakobzhao.github.io/storymap/img/logo.png' width='18px' target='_blank' > storymap.js </a>");


                    if (settings.credits) {
                        $(".storymap-attribution").find("a").prepend(settings.credits + " | ");


                    }

                    if (settings.mapinteraction) {

                        map.dragging.enable();
                        map.touchZoom.enable();
                        map.doubleClickZoom.enable();
                        map.scrollWheelZoom.enable();
                        map.boxZoom.enable();
                        map.keyboard.enable();
                        if (map.tap) map.tap.enable();

                        $("storymap-map").css("cursor", "grab");

                    } else {

                        map.dragging.disable();
                        map.touchZoom.disable();
                        map.doubleClickZoom.disable();
                        map.scrollWheelZoom.disable();
                        map.boxZoom.disable();
                        map.keyboard.disable();
                        if (map.tap) map.tap.disable();
                        $("storymap-map").css("cursor", "pointer");
                    }

                    if (settings.navbar && nav.length > 0) {



                        //$(".navbar-header").after("<div class='collapse navbar-collapse nav navbar-nav navbar-right storymap-navbar'>");


                        $.each(sections, function (key, element) {
                            var section = $(element);
                            // if no name attribute for a specific scene, the name on the navigation bar will be the object name.
                            if (typeof (scenes[section.data('scene')].name) === "undefined") {
                                sceneName = section.data('scene');
                            } else {
                                sceneName = scenes[section.data('scene')].name.replace(" ", "&nbsp;");
                            }

                            scrollScript = "javascript:window.scrollBy(0, $('section[data-scene=\\'" + section.data('scene') + "\\']').offset().top - $(window).scrollTop() - $('.storymap-navbar').height() - 30);";

                            // $(".storymap-navbar").append('<li><a title="' + sceneName + '" href="' + scrollScript + '" >' + sceneName + '</a></li>');


                            $(".navbar-nav").append('<li class="nav-item"><a class="nav-link"' + '" href="' + scrollScript + '" >' + sceneName + '</a></li>');

                        });
                    }


                    $.each(sections, function (key, element) {
                        var section = $(element);


                        var path = section.data('background');
                        if (typeof path !== 'undefined') {


                            if (path.indexOf("jpg") >= 0 || path.indexOf("jpeg") >= 0 || path.indexOf("png") >= 0 || path.indexOf("bmp") >= 0 || path.indexOf("gif") >= 0) {
                                $("head").append("<style> ." + section.data('scene') + "-bg-img { background: url(" + path + ") no-repeat center center fixed; -webkit-background-size: cover; -moz-background-size: cover;  -o-background-size: cover; background-size: cover; }</style>");

                                $(section).find(".fullscreen").addClass(section.data('scene') + "-bg-img");

                            } else if (path.indexOf("mp4") >= 0) {

                                $(section).find(".fullscreen").before('<video class="fullscreen canvas-center"  playsinline autoplay muted loop><source src=' + path + '  type="video/mp4"></video>')

                            } else {
                                console.log(path);
                            }
                        }

                    });


                    if (!String.prototype.includes) {
                        String.prototype.includes = function () {
                            'use strict';
                            return String.prototype.indexOf.apply(this, arguments) !== -1;
                        };
                    }

                    // make nav bar on the top.
                    if (nav.length !== 0) {

                        var navbar_height = nav.height();

                        var origin_main_top = nav.position().top;

                        $(".storymap-story").css({
                            top: (navbar_height + origin_main_top).toString() + "px"
                        });

                    }

                    $.each(layers, function (key, layer) {

                        // layer = layer.layer;
                        layer.layer.on('s');
                        layer.layer.on('load', function () {
                            $(".storymap-loader").fadeTo(1000, 0);
                        })

                    });

                    function showMap(key) {

                        currentLayerGroup.clearLayers();

                        var scene = scenes[key];
                        var legendContent = "";

                        if (typeof $("section[data-scene='" + key + "']").data("background") !== 'undefined') {

                            $(".storymap-loader").fadeTo(0, 0);

                        } else if (typeof $("section[data-scene='" + key + "']").data("background") === 'undefined') {

                            for (var i = 0; i < scene.layers.length; i++) {
                                $(".storymap-loader").fadeTo(0, 1);
                                currentLayerGroup.addLayer(scene.layers[i].layer);

                                if (typeof scene.layers[i].legend !== 'undefined') {
                                    legendContent += scene.layers[i].legend;
                                }
                            }
                            $(".storymap-loader").fadeTo(1, 0);

                        }


                        // the condition legendContent != "" will make sure the legend will only be added on when there is some contents in the legend.
                        if (settings.legend && legendContent !== "") {
                            $(".storymap-legend")
                                .html(legendContent)
                                .show();
                        } else {
                            $(".storymap-legend").hide();

                        }

                        if (settings.flyto) {
                            map.flyTo([scene.lat, scene.lng], scene.zoom, {
                                animate: true,
                                easeLinearity: 1,
                                duration: 2 // in seconds
                            })
                        } else {
                            map.setView([scene.lat, scene.lng], scene.zoom, {
                                animate: false,
                                easeLinearity: 1,
                                duration: 2 // in seconds
                            })

                        }


                        map.invalidateSize();

                    }

                    function executeScript(key) {
                        var scene = scenes[key];
                        var section = $('section[data-scene="' + key + '"]')
                        scene.script(key, map, section);
                    }


                    sections.on('viewing', function () {

                        $(this)
                            .removeClass('invisible')
                            .addClass('visible')
                            .addClass('viewing');
                        var scrollDown = $(".storymap-scroll-down");

                        scrollDown
                            .addClass('justify-content-center')
                            .removeClass('justify-content-left');

                        if (typeof $(this).data("background") !== 'undefined') {
                            $(this)
                                .removeClass('justify-content-center')
                                .addClass('justify-content-left')
                                .addClass('section-opacity');

                            scrollDown
                                .removeClass('justify-content-left')
                                .addClass('justify-content-center');
                        }



                        if ($(this).data('scene') === sections.last().data('scene')) {
                            scrollDown
                                .html("home")
                                .addClass('justify-content-center')
                                .removeClass('justify-content-left');
                        } else {
                            scrollDown
                                .html("keyboard_arrow_down")
                                .removeClass('justify-content-center')
                                .addClass('justify-content-left');
                        }



                        // Bounce the storymap-scroll-down icon when the icon is on the front page.
                        if ($(this).data('scene') === sections.first().data('scene') || $(this).data('scene') === sections.last().data('scene')) {
                            scrollDown
                                .addClass("animated")
                                .addClass('justify-content-center')
                                .removeClass('justify-content-left');
                        } else {
                            scrollDown
                                .removeClass("animated");
                        }

                        showMap($(this).data('scene'));

                        if (typeof (scenes[$(this).data('scene')].script) !== 'undefined') {
                            executeScript($(this).data('scene'));
                        }
                    });


                    sections.on('notviewing', function () {


                        $(this)
                            .removeClass('viewing')
                            .removeClass('visible')
                            .addClass('invisible');
                    });


                    watchHighlight(element, searchfor, top);
                    window.scrollTo(0, 1);


                    $('.storymap-scroll-down').click(function () {
                        var viewing = $(".viewing");
                        if (viewing.data("scene") !== $("section[data-scene]:last").data('scene')) {

                            if (nav.length !== 0) {
                                window.scrollBy(0, viewing.offset().top + viewing.height() - $(window).scrollTop() - $('.storymap-navbar').height() - 10);
                            } else {
                                window.scrollBy(0, viewing.offset().top + viewing.height() - $(window).scrollTop() - 10);
                            }
                        } else {
                            window.scrollTo(0, 0);
                        }
                    });


                    // create a progress line
                    $(window).scroll(function () {
                        var wintop = $(window).scrollTop(),
                            docheight = $(document).height(),
                            winheight = $(window).height();
                        var scrolled = (wintop / (docheight - winheight)) * 100;

                        $('.storymap-progressline').css('width', (scrolled + '%'));
                    });


                    // create the navigation widget to the left side of the browser's window.
                    if (settings.navwidget) {
                        $.each(sections, function (key, element) {
                            var section = $(element);
                            // if no name attribute for a specific scene, the name on the navigation bar will be the object name.
                            if (typeof (scenes[section.data('scene')].name) === "undefined") {
                                sceneName = section.data('scene');
                            } else {
                                sceneName = scenes[section.data('scene')].name.replace(" ", "&nbsp;");
                            }

                            //if there is a navbar.
                            if (nav.length !== 0) {
                                scrollScript = "javascript:window.scrollBy(0, $('section[data-scene=\\'" + section.data('scene') + "\\']').offset().top - $(window).scrollTop() - $('.storymap-navbar').height() - 30);";
                            } else {
                                scrollScript = "javascript:window.scrollBy(0, $('section[data-scene=\\'" + section.data('scene') + "\\']').offset().top  - $(window).scrollTop() - 10);";
                            }


                            // if key is equal to 0, meaning it is the first scene.
                            if (key === 0) {
                                $(".storymap-navwidget").append('<li><a class="material-icons" style="font-size: 16px" data-toggle="tooltip" title="' + sceneName + '" href="' + scrollScript + '" >home</a></li>');
                            } else {
                                $(".storymap-navwidget").append('<li><a class="material-icons" style="font-size: 12px" data-toggle="tooltip" title="' + sceneName + '" href="' + scrollScript + '" >lens</a></li>');
                            }
                        });

                        $('[data-toggle="tooltip"]').tooltip({
                            placement: 'right',
                            html: true
                        });

                        $(".storymap-navwidget").hover(function () {
                            $(this).fadeTo(100, 0.8);
                        }, function () {
                            $(this).fadeTo(300, 0);
                        });
                    }

                };

                makeStoryMap(this, settings.scenes);
                window.scrollTo(0, 0);
                return this;
            }

        }(jQuery));

    </script>
</body>

</html>