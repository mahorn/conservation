<!DOCTYPE html>
<html>

<head>
    <meta charset=utf-8 />
    <title>Conservation Areas in South America</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- <script src='https://api.mapbox.com/mapbox.js/v3.2.0/mapbox.js'></script> -->
    <!-- added mapbox-gl-js to see if ocean loads -->
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.53.1/mapbox-gl.css' rel='stylesheet' />
    <!-- end of mapbox-gl-js to see if ocean loads -->
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <link href="https://api.mapbox.com/mapbox-assembly/v0.21.2/assembly.min.css" rel="stylesheet">
    <link href='https://api.mapbox.com/mapbox.js/v3.2.0/mapbox.css' rel='stylesheet' />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" />
    <link href="https://fonts.googleapis.com/css?family=PT+Sans:400,700" rel="stylesheet">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" />

    <style>
        body {
            padding-top: 0;
        }
        
        #map {
            padding: 0;
            position: fixed;
            width: 100%;
            height: 100%;
        }
        
        .navbar-header {
            padding-top: 0rem;
            width: 26rem;
            position: fixed;
        }
        
        aside {
            width: 11rem;
            position: fixed;
            top: 0;
            right: 0;
            bottom: 0;
            background-color: rgb(0, 0, 0);
            overflow-y: scroll;
        }
        
        .aside-chapters {
            padding-top: 1rem;
            padding-bottom: 1rem;
            padding-left: 3rem;
        }
        
        .aside-icons {
            padding-top: 0.5rem;
        }
        
        a.icon-hover:hover img {
            opacity: 0.6;
        }
        
        #features {
            padding-top: 10%;
            padding-bottom: 25%;
            width: 20%;
            margin-left: 10%;
            display: none;
            font-family: sans-serif;
            overflow-y: scroll;
            background-color: #fafafa;
            z-index: 4000;
        }
        
        section {
            padding: 20px 25px;
            line-height: 25px;
            border-bottom: 1px solid #ddd;
            opacity: 0.5;
            font-size: 13px;
        }
        
        section.active {
            opacity: 1;
        }
        
        section:last-child {
            border-bottom: none;
            margin-bottom: 200px;
        }
        
        .mapboxgl-popup {
            max-width: 200px;
        }
        
        .mapboxgl-popup-content {
            text-align: center;
            font-family: 'Open Sans', sans-serif;
            background: rgba(0, 0, 0, 0.6);
            color: white;
        }
        
        #aside-icon-gallery {
            position: absolute;
            display: none;
            z-index: 4000;
            right: 10%;
            top: 0;
            width: 40%;
            height: 100%;
            background: #F4FAF2;
            overflow-y: scroll;
        }
        
        #aside-icon-explore {
            position: absolute;
            display: none;
            z-index: 4000;
            right: 10%;
            top: 0;
            width: 28%;
            height: 100%;
            background: #F4FAF2;
        }
        
        .text-gallery {
            color: teal;
            font-size: 18px;
        }
        
        .text-gallery-footer {
            color: purple;
            font-size: 12px;
        }
        
        .amphibian-img-text {
            color: #344d90;
            font-size: 12px;
            margin-left: 24px;
            margin-top: 8px;
        }
        
        .reptile-img-text {
            color: #e7552c;
            font-size: 12px;
            margin-left: 18px;
            margin-top: 20px;
        }
        
        .mammal-img-text {
            color: #ffb745;
            font-size: 12px;
            margin-left: 34px;
            margin-top: 24px;
        }
        
        .bird-img-text {
            color: #5cc5ef;
            font-size: 12px;
            margin-left: 30px;
            margin-top: 24px;
        }
        /* .marker {
            background-image: url('pics/wildlife_icon.png');
            background-size: cover;
            width: 20px;
            height: 20px;
            border-radius: 5%;
            cursor: pointer;
        } */
        
        #icon a:active {
            background-color: #3887be;
            color: #ffffff;
        }
        
        #icon a:active :hover {
            background-color: #3887be;
            color: #ffffff;
        }
        
        #icon a:last-child {
            border: none;
        }
        
        .layer-icons {
            color: #ffb745;
        }
        
        span {
            color: #ffb745;
        }
        
        #amphibian a:active {
            background-color: #3887be;
            color: #ffffff;
        }
        
        #amphibian a:active :hover {
            background-color: #3887be;
            color: #ffffff;
        }
        
        #amphibian a:last-child {
            border: none;
        }
        /* .img {
        top: 30%;
        position: absolute;
        margin-left: 50%;
        font-family: sans-serif;
        z-index: 4000;
    } */
        
        #AMp {
            position: absolute;
            display: none;
            z-index: 5000;
            right: 26%;
            top: 24%;
            width: 40%;
            height: 40%;
            background: transparent;
        }
        
        #REp {
            position: absolute;
            display: none;
            z-index: 5000;
            right: 26%;
            top: 24%;
            width: 40%;
            height: 40%;
            background: transparent;
        }
        
        #MAm {
            position: absolute;
            display: none;
            z-index: 5000;
            right: 26%;
            top: 24%;
            width: 40%;
            height: 40%;
            background: transparent;
        }
        
        #BIr {
            position: absolute;
            display: none;
            z-index: 5000;
            right: 26%;
            top: 24%;
            width: 40%;
            height: 40%;
            background: transparent;
        }
        
        .section {
            padding: 4%;
        }
        
        .section input[type="radio"] {
            display: none;
        }
        
        .container {
            margin-top: 5px;
            margin-bottom: 5px;
        }
        
        .container label {
            position: relative;
        }
        /* Base styles for spans */
        
        .container span::before,
        .container span::after {
            content: '';
            position: absolute;
            top: 0;
            bottom: 0;
            margin: auto;
        }
        /* Radio buttons */
        
        .container span.radio:hover {
            cursor: pointer;
        }
        
        .container span.radio::before {
            left: -52px;
            width: 45px;
            height: 25px;
            border-radius: 50px;
        }
        
        .container span.radio::after {
            left: -49px;
            width: 17px;
            height: 17px;
            border-radius: 10px;
            background-color: #6C788A;
            transition: left .25s, background-color .25s;
        }
        
        input[type="radio"]:checked+label span.radio::after {
            left: -27px;
            background-color: #EBFF43;
        }
        
        .category {
            color: #6C788A;
            font-size: 13px;
        }
        
        .radio {
            color: transparent;
        }
        
        #title {
            color: rgb(205, 156, 50);
            font-size: 14px;
        }
        
        .btn {
            background: #2b616d;
        }
        
        .btn:hover,
        .btn.selected {
            background: #b2dbd5;
            -webkit-text-fill-color: #2b616d;
        }
        
        #about-trigger.btn {
            padding: 0;
        }
        
        #about-global.btn {
            padding: 0;
        }
        
        #about-modal {
            background: rgba(48, 48, 48, 0.50);
            -webkit-text-fill-color: #b2dbd5;
        }
    </style>
</head>

<body>
    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    <!--adding libraries to see if ocean loads-->
    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.53.1/mapbox-gl.js'></script>
    <script src="https://d3js.org/d3.v5.min.js"></script>
    <script src="https://unpkg.com/topojson@3"></script>

    <!--scrolling libraries-->
    <!-- <script src="lib/d3.js"></script>
    <script src="js/scroller.js"></script>
    <script src="js/sections.js"></script> -->

    <div id='map'>
        <!-- <a href="https://getbootstrap.com" class="img">
                    <img src="pics/introduction.png" alt="HTML tutorial" style='width:300px;height:300px'></a> -->


        <div id='aside-icon-gallery'>
            <div id='AMp'>
                <overlay id="first" class="section ">
                    <div class="container">
                        <input type="radio" name="group1" id="radio-AMp-1">
                        <label for="radio-AMp-1"><span class="radio"></span><span class="category">Extinct</span></span>
                        </label>
                    </div>
                    <div class="container">
                        <input type="radio" name="group1" id="radio-AMp-2">
                        <label for="radio-AMp-2"><span class="radio"></span><span class="category">Probably Extinct</span></span></label>
                    </div>
                    <div class="container">
                        <input type="radio" name="group1" id="radio-AMp-3">
                        <label for="radio-AMp-3"><span class="radio"></span><span class="category">Extant (resident)</span></span></label>
                    </div>
                    <div class="container">
                        <input type="radio" name="group1" id="radio-AMp-4">
                        <label for="radio-AMp-4"><span class="radio"></span><span class="category">Presence Uncertain</span></span></label>
                    </div>
                </overlay>
            </div>


            <div id='REp'>
                <overlay id="second" class="section ">
                    <div class="container">
                        <input type="radio" name="group2" id="radio-REp-1">
                        <label for="radio-REp-1"><span class="radio"></span><span class="category">Extant (resident)</span></span>
                        </label>
                    </div>
                    <div class="container">
                        <input type="radio" name="group2" id="radio-REp-2">
                        <label for="radio-REp-2"><span class="radio"></span><span class="category">Extant & Origin Uncertain (resident)</span></span></label>
                    </div>
                    <div class="container">
                        <input type="radio" name="group2" id="radio-REp-3">
                        <label for="radio-REp-3"><span class="radio"></span><span class="category">Extant & Reintroduced (resident)</span></span></label>
                    </div>
                    <div class="container">
                        <input type="radio" name="group2" id="radio-REp-4">
                        <label for="radio-REp-4"><span class="radio"></span><span class="category">Extant & Vagrant (resident)</span></span></label>
                    </div>
                    <div class="container">
                        <input type="radio" name="group2" id="radio-REp-5">
                        <label for="radio-REp-5"><span class="radio"></span><span class="category">Extinct</span></span></label>
                    </div>
                    <div class="container">
                        <input type="radio" name="group2" id="radio-REp-6">
                        <label for="radio-REp-6"><span class="radio"></span><span class="category">Possible Extant (resident)</span></span></label>
                    </div>
                    <div class="container">
                        <input type="radio" name="group2" id="radio-REp-7">
                        <label for="radio-REp-7"><span class="radio"></span><span class="category">Possible Extinct</span></span></label>
                    </div>
                </overlay>
            </div>

            <div id='MAm'>
                <overlay id="thirth" class="section ">
                    <div class="container">
                        <input type="radio" name="group3" id="radio-MAm-1">
                        <label for="radio-MAm-1"><span class="radio"></span><span class="category">Extant (resident)</span></span>
                        </label>
                    </div>
                    <div class="container">
                        <input type="radio" name="group3" id="radio-MAm-2">
                        <label for="radio-MAm-2"><span class="radio"></span><span class="category">Possible Extinct</span></span></label>
                    </div>
                    <div class="container">
                        <input type="radio" name="group3" id="radio-MAm-3">
                        <label for="radio-MAm-3"><span class="radio"></span><span class="category">Probably Extant (resident)</span></span></label>
                    </div>

                </overlay>
            </div>

            <div id='BIr'>
                <overlay id="fourth" class="section ">
                    <div class="container">
                        <input type="radio" name="group4" id="radio-BIr-1">
                        <label for="radio-BIr-1"><span class="radio"></span><span class="category">Extant (breeding)</span></span>
                        </label>
                    </div>
                    <div class="container">
                        <input type="radio" name="group4" id="radio-BIr-2">
                        <label for="radio-BIr-2"><span class="radio"></span><span class="category">Extant (non-breeding)</span></span></label>
                    </div>
                    <div class="container">
                        <input type="radio" name="group4" id="radio-BIr-3">
                        <label for="radio-BIr-3"><span class="radio"></span><span class="category">Extant (passage)</span></span></label>
                    </div>
                    <div class="container">
                        <input type="radio" name="group4" id="radio-BIr-4">
                        <label for="radio-BIr-4"><span class="radio"></span><span class="category">Extant (resident)</span></span></label>
                    </div>
                    <div class="container">
                        <input type="radio" name="group4" id="radio-BIr-5">
                        <label for="radio-BIr-5"><span class="radio"></span><span class="category">Extinct</span></span></label>
                    </div>
                    <div class="container">
                        <input type="radio" name="group4" id="radio-BIr-6">
                        <label for="radio-BIr-6"><span class="radio"></span><span class="category">Possible Extant (resident)</span></span></label>
                    </div>
                    <div class="container">
                        <input type="radio" name="group4" id="radio-BIr-7">
                        <label for="radio-BIr-7"><span class="radio"></span><span class="category">Possible Extinct</span></span></label>
                    </div>
                </overlay>
            </div>



            <div class="col-md-9 px-12 mt30 ml24">
                <a class="icon-hover mx-auto ml12 d-block"></a>
                <h1 class="title-gallery h4 font-weight-bold mr24 color-green-faint align-center">A NATURE OF WONDER</h1>
                <p class="text-gallery-footer lead my-4 align-center mr18">Click icons to view critically endangered species by category.
                </p>
                <ul class="images-hover">
                    <div id="title" class="lead my-4 align-center mr18"></div>
                    <a class="icon-hover mx-auto d-block"><img src="pics/amphibian_color.png" alt="Amphibian icon" id="am">

                    </a>
                    <a class="icon-hover mx-auto d-block my-1"><img src="pics/reptile_color.png" alt="Reptile icon" id="re">
                    </a>
                    <a class="icon-hover mx-auto d-block my-2"><img src="pics/mammal_color.png" alt="Mammal icon" id="ma">
                    </a>
                    <a class="icon-hover mx-auto d-block my-2"><img src="pics/bird_color.png" alt="Bird icon" id="bi">
                    </a>
                </ul>
                <p class="text-gallery-footer lead my-4 align-center mr24">Click icons to deselect layers. </p>

                <div class="row">
                    <div id="amphibian" class="col align-center"></div>
                    <div id="reptile" class="col align-center"></div>
                    <div class="w-100"></div>
                    <div id="mammal" class="col align-center"></div>
                    <div id="bird" class="col align-center"></div>
                </div>
            </div>
        </div>

        <div id='aside-icon-explore'>
            <div class="col-md-9 px-12 mt30 ml24">
                <h1 class="title-gallery h4 font-weight-bold mr24 color-green-faint align-center">EXPLORE THE MAP</h1>
                <ul class='layer-icons'>
                    <p class='layers text lead mr24 my-3 align-center'>Map Layers</p>
                    <div id='icon'>
                    </div>
                    <div id='icon1'>
                    </div>
                    <div id='icon2'>
                    </div>
                </ul>
                <p class="text-gallery-footer lead my-4 align-center mr24">Click icons to view critically endangered species & toggle map layers.
                </p>
                <ul class="images-hover">
                    <a class="icon-hover frog-img mx-auto ml12 d-block"><img src="pics/amphibian.png" alt="Amphibian icon" id="amphibian">
                        <p class="amphibian-img-text inline-block">Amphibians</p>
                    </a>
                    <a class="icon-hover mx-auto d-block ml12"><img src="pics/reptile.png" alt="Reptile icon" id="reptile">
                        <p class="reptile-img-text inline-block">Reptiles</p>
                    </a>
                    <a class="icon-hover mx-auto d-block my-3 mx18"><img src="pics/mammal.png" alt="Mammal icon" id="mammal">
                        <p class="mammal-img-text inline-block">Mammals</p>
                    </a>
                    <a class="icon-hover mx-auto d-block my-3 mx30"><img src="pics/bird.png" alt="Bird icon" id="bird">
                        <p class="bird-img-text inline-block">Birds</p>
                    </a>
                </ul>
            </div>
        </div>

    </div>

    <div class="navbar-header z2">
        <nav class="navbar navbar-expand-md navbar-dark navbar-fixed-top bg-dark">
            <a class="navbar-brand" href="#">Conservation</a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarCollapse">
                <ul class="navbar-nav mr-auto">
                    <li class="nav-item"><a class="nav-link" href="#">About</a></li>
                    <li class="nav-item"><a class="nav-link" href="#">Take Action</a></li>
                    <li class="nav-item"><a class="nav-link" href="#">Language</a></li>
                </ul>
        </nav>
        </div>

        <aside class="aside z3">
            <ul class="aside-chapters">
                <li class="aside-icons">
                    <a class="icon-hover" id='icon-story'><img src="pics/story.png" alt="HTML tutorial" style="width:90px;height:90px;"></a>
                </li>
                <li class="aside-icons">
                    <a class="icon-hover" id='icon-gallery'><img src="pics/gallery.png" alt="HTML tutorial" style="width:90px;height:90px;"></a>
                </li>
                <li class="aside-icons">
                    <a class="icon-hover" id='icon-explore'><img src="pics/explore.png" alt="HTML tutorial" style="width:90px;height:90px;"></a>
                </li>
            </ul>
            <div id='legend' class='absolute mt12 color-green-faint'>
                <div class='inline-block mb12 txt-m align-center mx12'>Conservation Areas IUCN</div>
                <ul class='color-green-faint txt-xxs mx18 align-l py2'></ul>
            </div>
        </aside>

        <div id='features'>
            <section id='introduction' class='active'>
                <h3>Conservation Areas in South America</h3>
                <p></p>
            </section>
            <section id='argentina'>
                <h3>Argentina</h3>
                <p>Argentina</p>
            </section>
            <section id='bolivia'>
                <h3>Bolivia</h3>
                <p>Bolivia</p>
            </section>
            <section id='brasil'>
                <h3>Brasil</h3>
                <p>Brasil</p>
            </section>
            <section id='chile'>
                <h3>Chile</h3>
                <p>Chile</p>
            </section>
            <section id='colombia'>
                <h3>Colombia</h3>
                <p>Colombia</p>
            </section>
            <section id='ecuador'>
                <h3>Ecuador</h3>
                <p>Ecuador</p>
            </section>
            <section id='french guiana'>
                <h3>French Guiana</h3>
                <p>French Guiana</p>
            </section>
            <section id='guyana'>
                <h3>Guyana</h3>
                <p>Guyana</p>
            </section>
            <section id='paraguay'>
                <h3>Paraguay</h3>
                <p>Paraguay</p>
            </section>
            <section id='peru'>
                <h3>Peru</h3>
                <p>Peru</p>
            </section>
            <section id='surinam'>
                <h3>Surinam</h3>
                <p>Surinam</p>
            </section>
            <section id='uruguay'>
                <h3>Uruguay</h3>
                <p>Uruguay</p>
            </section>
            <section id='venezuela'>
                <h3>Venezuela</h3>
                <p>Venezuela</p>
                <small id="THANK YOU">
                Tank you! <a href='http://www.gutenberg.org/files/2346/2346-h/2346-h.htm'>Project Gutenberg</a>
            </small>
            </section>
        </div>


        <div class='absolute left top mr12 mb12 color-green-faint z2 round px24 py24 align-r z11'>
            <button id='about-icon' class='btn'>
                <svg class='icon link color-lighten50 txt-l'>
                    <use xlink:href='#icon-refresh'></use>
                </svg>
            </button>
        </div>


        <script>
            mapboxgl.accessToken = 'pk.eyJ1IjoibWFob3JuIiwiYSI6ImNpbnV0enJ4ZTEyNG91YW0zNGF6bTlva2wifQ.7jRtxQoaV2PHlRD7fu6U-g';

            var map = new mapboxgl.Map({
                container: 'map',
                style: 'mapbox://styles/mapbox/light-v9',
                center: [-65, -15],
                zoom: 2.6,
            });

            var colorAreas = {
                'Ia': '#505160',
                'Ib': '#68829e',
                'II': '#aebd38',
                'III': '#598234',
                'IV': '#003b46',
                'V': '#07575b',
                'VI': '#66a5ad',
                'Not Reported': '#c4dfe6',
                'Not Applicable': '#a2c523'
            }

            var colorSpecies = {
                'amphibians-filtered': '#acd0c0',
                'birds': '#75b1a9',
                'mammals-filtered': '#d9b44a',
                'reptiles-filtered': '#4f6457'
            }

            var colorAmphibians = {
                'Extant (resident)': '#4D648D',
                'Extinct': '#1E1F26',
                'Possible Extinct': '#283655',
                'Presence Uncertain': '#D0EQF9'
            }


            var colorReptiles = {
                'Extant (resident)': '#324851',
                'Extant & Origin Uncertain (resident)': '#86AC41',
                'Extant & Reintroduced (resident)': '#34675C',
                'Extant & Vagrant (resident)': '#7DA3A1',
                'Extinct': '#34675C',
                'Possible Extant (resident)': '#B3C100',
                'Possible Extinct': '#6AB187'
            }

            var colorMammals = {
                'Extant (resident)': '#FA4032',
                'Possible Extinct': '#FA812F',
                'Probably Extant (resident)': '#FAAF08'
            }

            var colorBirds = {
                'Extant (breeding)': '#CDBEA7',
                'Extant (non-breeding)': '#323030',
                'Extant (passage)': '#C29545',
                'Extant (resident)': '#42313A',
                'Extinct': '#6C2D2C',
                'Possible Extant (resident)': '#9F4636',
                'Possible Extinct': '#F1DCC9'
            }

            map.on('load', function() {

                d3.json('data/ocean.json')
                    .then(function(data) {
                        oceanMap(data);
                        addAboutModalUI();
                    });

                function oceanMap(data) {
                    var geojson = topojson.feature(data, data.objects.ocean);

                    map.addLayer({
                        'id': 'ocean',
                        'type': 'fill',
                        'source': {
                            'type': 'geojson',
                            'data': geojson
                        },
                        'paint': {
                            "fill-outline-color": "hsla(337, 82%, 62%, 0)",
                            "fill-color": ["interpolate", ["cubic-bezier",
                                    0, 0.5,
                                    1, 0.5
                                ],
                                ["get", "depth"],
                                0, "#f2f8fa",
                                9000, "#a7ccd2"
                            ],
                            "fill-opacity": 0.4
                        }
                    });
                } //end of oceanMap function





                d3.json('data/polygons.json')
                    .then(function(data) {
                        polygonsMap(data);
                        addLegend(data);
                    });

                function polygonsMap(data) {
                    var geojson = topojson.feature(data, data.objects.merge_files_sim);

                    map.addLayer({
                        'id': 'polygon',
                        'type': 'fill',
                        'source': {
                            'type': 'geojson',
                            'data': geojson
                        },
                        'paint': {
                            "fill-color": [
                                'match', ['get', 'IUCN_CAT'],
                                'Ia', '#505160',
                                'Ib', '#68829e',
                                'II', '#aebd38',
                                'III', '#598234',
                                'IV', '#003b46',
                                'V', '#07575b',
                                'VI', '#66a5ad',
                                'Not Reported', '#c4dfe6',
                                'Not Applicable', '#a2c523',
                                '#ccc'
                            ],
                            "fill-opacity": 0.4,
                        },
                    });

                    var popup = new mapboxgl.Popup({
                        closeButton: false,
                        closeOnClick: false
                    });

                    map.on('mousemove', 'polygon', function(e) {
                        var features = map.queryRenderedFeatures(e.lngLat);
                        map.getCanvas().style.cursor = 'pointer';
                        // map.flyTo({center: e.lngLat, zoom: 6});
                        popup.setLngLat(e.lngLat)
                            .setHTML(String(e.features[0].properties.NAME).toLocaleString())
                            .addTo(map)
                    });

                    map.on('mouseleave', 'polygon', function() {
                        map.getCanvas().style.cursor = '';
                        popup.remove();
                    });

                } //end of polygonsMap function

                function addLegend(data) {
                    var geojson = topojson.feature(data, data.objects.merge_files_sim);
                    var labelCodes = {},
                        code;

                    geojson.features.forEach(function(feature) {
                        code = feature.properties.IUCN_CAT;
                        if (!labelCodes[code]) {
                            labelCodes[code] = feature.properties.IUCN_CAT;
                        }
                    })
                    var listItems = '';
                    for (var code in colorAreas) {
                        listItems += "<li class='li h-full txt-m'><span class='w24 h18 fl mr12' style='background:" +
                            colorAreas[code] + "'></span>" + labelCodes[code] + "</li>"
                    }
                    d3.select("#legend ul").html(listItems);
                    d3.select('#legend').classed('none', false);

                } //end of addLegend function

                d3.json('data/points.json')
                    .then(function(data) {
                        pointsMap(data);
                    });

                function pointsMap(data) {

                    map.addLayer({
                        'id': 'points',
                        'type': 'circle',
                        'source': {
                            'type': 'geojson',
                            'data': data
                                //   'cluster': true,
                                //   'clusterMaxZoom': 4, // Max zoom to cluster points on
                                //  'clusterRadius': 2 // Radius of each cluster when clustering points (defaults to 50)
                        },
                        'paint': {
                            'circle-color': [
                                'match', ['get', 'IUCN_CAT'],
                                'Ia', '#505160',
                                'Ib', '#68829e',
                                'II', '#aebd38',
                                'III', '#598234',
                                'IV', '#003b46',
                                'V', '#07575b',
                                'VI', '#66a5ad',
                                'Not Reported', '#c4dfe6',
                                'Not Applicable', '#a2c523',
                                '#ccc'
                            ],
                            'circle-radius': 4,
                            'circle-opacity': .6,
                        },
                    });

                    var popup = new mapboxgl.Popup({
                        closeButton: false,
                        closeOnClick: false
                    });

                    map.on('mousemove', 'points', function(e) {
                        var features = map.queryRenderedFeatures(e.lngLat);
                        map.getCanvas().style.cursor = 'pointer';
                        popup.setLngLat(e.lngLat)
                            .setHTML(String(e.features[0].properties.NAME).toLocaleString())
                            .addTo(map)
                    });
                    map.on('mouseleave', 'points', function() {
                        map.getCanvas().style.cursor = '';
                        popup.remove();
                    });

                } //end of function pointsMap

                d3.json('data/species.json')
                    .then(function(data) {
                        speciesMap(data);
                    });

                function speciesMap(data) {

                    map.addLayer({
                        'id': 'species',
                        'type': 'fill',
                        'source': {
                            'type': 'geojson',
                            'data': data
                        },
                        'paint': {
                            "fill-color": [
                                'match', ['get', 'layer'],
                                'amphibians-filtered', '#acd0c0',
                                'birds', '#75b1a9',
                                'mammals-filtered', '#d9b44a',
                                'reptiles-filtered', '#4f6457',
                                '#ccc'
                            ],
                            "fill-opacity": 0.6,
                        },
                        // 'layout': none'
                    });

                    var popup = new mapboxgl.Popup({
                        closeButton: false,
                        closeOnClick: false
                    });

                    map.on('mousemove', 'species', function(e) {
                        var features = map.queryRenderedFeatures(e.lngLat);

                        map.getCanvas().style.cursor = 'pointer';
                        popup.setLngLat(e.lngLat)
                            .setHTML(String(e.features[0].properties.binomial).toLocaleString())
                            .addTo(map)
                    });
                    map.on('mouseleave', 'species', function() {
                        map.getCanvas().style.cursor = '';
                        popup.remove();
                    });

                } //end of speciesMap function

                d3.json('data/amphibians-filtered.json')
                    .then(function(data) {
                        amphibianMap(data);
                        amphibianMapToggle(data);
                    });



                function amphibianMap(data) {

                    map.addLayer({
                        'id': 'amphibian',
                        'type': 'fill',
                        'source': {
                            'type': 'geojson',
                            'data': data
                        },
                        'paint': {
                            "fill-color": [
                                'match', ['get', 'legend'],
                                'Extant (resident)', '#4D648D',
                                'Extinct', '#1E1F26',
                                'Possible Extinct', '#283655',
                                'Presence Uncertain', '#D0EQF9',
                                '#000000'
                            ],
                            "fill-opacity": 0.4,

                        },

                    });

                    var popup = new mapboxgl.Popup({
                        closeButton: false,
                        closeOnClick: false
                    });

                    map.on('mousemove', 'amphibian', function(e) {
                        var features = map.queryRenderedFeatures(e.lngLat);

                        map.getCanvas().style.cursor = 'pointer';
                        popup.setLngLat(e.lngLat)
                            .setHTML(String(e.features[0].properties.legend + e.features[0].properties.binomial).toLocaleString())
                            .addTo(map)
                    });
                    map.on('mouseleave', 'amphibian', function() {
                        map.getCanvas().style.cursor = '';
                        popup.remove();
                    });

                } //end of amphibianMap function


                function amphibianMapToggle(data) {

                    $('#am').click(function() {
                        $('#AMp').toggle();
                        $('#title').html("<strong>AMPHIBIANS</strong");
                    });


                    //     data.features.forEach(function(feature) {
                    //         var legend = feature.properties['legend'];
                    //         var layerID = id + legend;
                    //         console.log(layerID);
                    // console.log(layerID);

                    // });



                    //     two.className = '';
                    //     this.className = 'active';
                    //     map.markerLayer.setFilter(function(f) {
                    //         return f.properties['legend'] === 'Extinct';
                    //     });
                    //     one.onclick = function(legend) {    return true;

                    // };

                    // two.onclick = function() {
                    //     one.className = '';
                    //     this.className = 'category';
                    //     map.markerLayer.setFilter(function(f) {
                    //         return true;
                    //     });
                    //     return false;
                    // }

                    //     var toggleablefilterGroupIds = ['radio-AMp-1', 'radio-AMp-2', 'radio-AMp-3', 'radio-AMp-4'];
                    //     for (var i = 0; i < toggleablefilterGroupIds.length; i++) {
                    //         var id = toggleablefilterGroupIds[i];

                    //         data.features.forEach(function(feature) {
                    //             var legend = feature.properties.legend;
                    //             console.log(legend);
                    //         });


                    //                         id.onclick = function (e) {
                    // var clickedLayer = this.textContent;
                    // e.preventDefault();
                    // e.stopPropagation();

                    //                         }


                    // }

                    //     filterGroup.addEventListener('change', function(e) {
                    //         map.setLayoutProperty(layerID, 'visibility',
                    //             e.target.checked ? 'visible' : 'none');
                    //     });

                    //     $('#am').click(function() {
                    //         $('#AMp').toggle();
                    //         $('#title').html("<strong>AMPHIBIANS</strong");
                    //     });



                } //end of amphibianMapToggle function






                d3.json('data/reptiles-filtered.json')
                    .then(function(data) {
                        reptileMap(data);
                    });

                function reptileMap(data) {

                    map.addLayer({
                        'id': 'reptile',
                        'type': 'fill',
                        'source': {
                            'type': 'geojson',
                            'data': data
                        },
                        'paint': {
                            "fill-color": [
                                'match', ['get', 'legend'],
                                'Extant (resident)', '#324851',
                                'Extant & Origin Uncertain (resident)', '#86AC41',
                                'Extant & Reintroduced (resident)', '#34675C',
                                'Extant & Vagrant (resident)', '#7DA3A1',
                                'Extinct', '#34675C',
                                'Possible Extant (resident)', '#B3C100',
                                'Possible Extinct', '#6AB187',
                                '#000000'
                            ],
                            "fill-opacity": 0.4,
                        },
                        // 'layout': none'
                    });

                    var popup = new mapboxgl.Popup({
                        closeButton: false,
                        closeOnClick: false
                    });

                    map.on('mousemove', 'reptile', function(e) {
                        var features = map.queryRenderedFeatures(e.lngLat);

                        map.getCanvas().style.cursor = 'pointer';
                        popup.setLngLat(e.lngLat)
                            .setHTML(String(e.features[0].properties.legend).toLocaleString())
                            .addTo(map)
                    });

                    map.on('mouseleave', 'reptile', function() {
                        map.getCanvas().style.cursor = '';
                        popup.remove();
                    });

                } //end of reptileMap function


                d3.json('data/mammals-filtered.json')
                    .then(function(data) {
                        mammalMap(data);
                    });

                function mammalMap(data) {

                    map.addLayer({
                        'id': 'mammal',
                        'type': 'fill',
                        'source': {
                            'type': 'geojson',
                            'data': data
                        },
                        'paint': {
                            "fill-color": [
                                'match', ['get', 'legend'],
                                'Extant (resident)', '#FA4032',
                                'Possible Extinct', '#FA812F',
                                'Probably Extant (resident)', '#FAAF08',
                                '#000000'
                            ],
                            "fill-opacity": 0.4,
                        },
                        // 'layout': none'
                    });

                    var popup = new mapboxgl.Popup({
                        closeButton: false,
                        closeOnClick: false
                    });

                    map.on('mousemove', 'mammal', function(e) {
                        var features = map.queryRenderedFeatures(e.lngLat);

                        map.getCanvas().style.cursor = 'pointer';
                        popup.setLngLat(e.lngLat)
                            .setHTML(String(e.features[0].properties.legend).toLocaleString())
                            .addTo(map)
                    });

                    map.on('mouseleave', 'mammal', function() {
                        map.getCanvas().style.cursor = '';
                        popup.remove();
                    });

                } //end of mammalMap function



                var birds = d3.json('data/birds.json')
                    .then(function(data) {
                        birdMap(data);
                    });

                function birdMap(data) {

                    map.addLayer({
                        'id': 'bird',
                        'type': 'fill',
                        'source': {
                            'type': 'geojson',
                            'data': data
                        },
                        'paint': {
                            "fill-color": [
                                'match', ['get', 'LEGEND'],
                                'Extant (breeding)', '#CDBEA7',
                                'Extant (non-breeding)', '#323030',
                                'Extant (passage)', '#C29545',
                                'Extant (resident)', '#42313A',
                                'Extinct', '#6C2D2C',
                                'Possible Extant (resident)', '#9F4636',
                                'Possible Extinct', '#F1DCC9',
                                '#000000'
                            ],
                            "fill-opacity": 0.4,
                        },
                        // 'layout': none'
                    });

                    var popup = new mapboxgl.Popup({
                        closeButton: false,
                        closeOnClick: false
                    });

                    map.on('mousemove', 'bird', function(e) {
                        var features = map.queryRenderedFeatures(e.lngLat);

                        map.getCanvas().style.cursor = 'pointer';
                        popup.setLngLat(e.lngLat)
                            .setHTML(String(e.features[0].properties.LEGEND).toLocaleString())
                            .addTo(map)
                    });

                    map.on('mouseleave', 'bird', function() {
                        map.getCanvas().style.cursor = '';
                        popup.remove();
                    });

                } //end of birdMap function


                // var onZoomend = function () {
                //     map.setMaxBounds(map.getBounds())
                //      d3.select('#legend').classed('none', false);
                //     map.off('zoomend', onZoomend);
                // };
                // map.on('zoomend', onZoomend);



                // add markers to map
                // data.features.forEach(function (marker) {
                //     // create a HTML element for each feature
                //     var el = document.createElement('div');
                //     el.className = 'marker';
                //     // make a marker for each feature and add to the map
                //     new mapboxgl.Marker(el)
                //         .setLngLat(marker.geometry.coordinates)
                //         .setPopup(new mapboxgl.Popup({ offset: 25 }) // add popups
                //             .setHTML('<h3>' + marker.properties.NAME + '</h3><p>' + marker.properties.DESIG_ENG + '</p><p>' + marker.properties.IUCN_CAT + '</p>'))
                //         .addTo(map);
                // });
                // var marker = new L.Marker(data.getBounds().getCenter()).addTo(map);



            }); //end of map.on('load')

            $('#icon-story').click(function() {
                $('#features').toggle();
                map.fitBounds([-75, -10, -25, -15], {
                    zoom: 2.6
                });
            }); //end of Icon-story

            var chapters = {
                'introduction': {
                    center: [-65, -15],
                    zoom: 3.2,
                },
                'argentina': {
                    center: [-63.6167, -38.4161],
                    zoom: 3.5,
                },
                'bolivia': {
                    center: [-63.5887, -16.2902],
                    zoom: 5,
                },
                'brasil': {
                    center: [-55.9253, -12.2350],
                    zoom: 3.8,
                },
                'chile': {
                    center: [-71.5430, -38.4161],
                    zoom: 4
                },
                'colombia': {
                    center: [-74.2973, 2.5709],
                    zoom: 5,
                },
                'ecuador': {
                    center: [-78.1834, -1.8312],
                    zoom: 6
                },
                'french guiana': {
                    center: [-53.1258, 3.9339],
                    zoom: 6,
                },
                'guyana': {
                    center: [-58.9302, 2.5904],
                    zoom: 5.5,
                },
                'paraguay': {
                    center: [-58.4438, -23.4425],
                    zoom: 5.5,
                },
                'peru': {
                    center: [-75.0152, -9.1900],
                    zoom: 5,
                },
                'surinam': {
                    center: [-55.9302, 2.3904],
                    zoom: 6,
                },
                'uruguay': {
                    center: [-55.8117 - 32.5583],
                    zoom: 5,
                },
                'venezuela': {
                    center: [-66.5897, -6.4238],
                    zoom: 4,
                }
            };

            window.onscroll = function() {
                var chapterNames = Object.keys(chapters);
                for (var i = 0; i < chapterNames.length; i++) {
                    var chapterName = chapterNames[i];
                    if (isElementOnScreen(chapterName)) {
                        setActiveChapter(chapterName);
                        break;
                    }
                }
            };

            var activeChapterName = 'introduction';

            function setActiveChapter(chapterName) {
                if (chapterName === activeChapterName) return;
                map.flyTo(chapters[chapterName]);
                document.getElementById(chapterName).setAttribute('class', 'active');
                document.getElementById(activeChapterName).setAttribute('class', '');
                activeChapterName = chapterName;
            }

            function isElementOnScreen(id) {
                var element = document.getElementById(id);
                var bounds = element.getBoundingClientRect();
                return bounds.top < window.innerHeight && bounds.bottom > 0;
            }



            var endClicked = $('#icon-gallery').on('click', function() {
                $('#aside-icon-gallery').toggle(
                    map.fitBounds([-75, -10, -25, -15], {
                        zoom: 2.6
                    })
                );
            });

            $('#icon-gallery').off('click', endClicked); // end of jquery selection icon-gallery


            // $('#am').click(function() {
            //     $('#AMp').toggle();
            //     $('#title').html("<strong>AMPHIBIANS</strong");
            // });

            $('#re').click(function() {
                $('#REp').toggle();
                $('#title').html("<strong>REPTILES</strong");
            });

            $('#ma').click(function() {
                $('#MAm').toggle();
                $('#title').html("<strong>MAMMALS</strong");
            });

            $('#bi').click(function() {
                $('#BIr').toggle();
                $('#title').html("<strong>BIRDS</strong");
            });




            var toggleableLayerIds = ['amphibian'];

            for (var i = 0; i < toggleableLayerIds.length; i++) {
                var id = toggleableLayerIds[i];

                var img = document.createElement('img');
                img.src = 'pics/amphibian_color_tab.png'
                img.className = 'active'
                img.id = 'picture'
                img.textContent = id

                img.onclick = function(e) {
                    var clickedLayer = this.textContent;
                    e.preventDefault();
                    e.stopPropagation();

                    var visibility = map.getLayoutProperty(clickedLayer, 'visibility');

                    if (visibility === 'visible') {
                        map.setLayoutProperty(clickedLayer, 'visibility', 'none');
                        this.className = '';
                    } else {
                        this.className = 'active';
                        map.setLayoutProperty(clickedLayer, 'visibility', 'visible');
                    }

                };

                var layers = document.getElementById('amphibian');
                layers.appendChild(img)
            }

            $(amphibian).hover(
                function() {
                    $(this).append($("<span> amphibian</span>"));
                },
                function() {
                    $(this).find("span:last").remove();
                }
            );


            var toggleableLayerIds = ['reptile'];

            for (var i = 0; i < toggleableLayerIds.length; i++) {
                var id = toggleableLayerIds[i];

                var img = document.createElement('img');
                img.src = 'pics/reptile_color_tab.png'
                img.className = 'active'
                img.id = 'picture'
                img.textContent = id

                img.onclick = function(e) {
                    var clickedLayer = this.textContent;
                    e.preventDefault();
                    e.stopPropagation();

                    var visibility = map.getLayoutProperty(clickedLayer, 'visibility');

                    if (visibility === 'visible') {
                        map.setLayoutProperty(clickedLayer, 'visibility', 'none');
                        this.className = '';
                    } else {
                        this.className = 'active';
                        map.setLayoutProperty(clickedLayer, 'visibility', 'visible');
                    }

                };

                var layers = document.getElementById('reptile');
                layers.appendChild(img)
            }

            $(reptile).hover(
                function() {
                    $(this).append($("<span> reptile</span>"));
                },
                function() {
                    $(this).find("span:last").remove();
                }
            );


            var toggleableLayerIds = ['mammal'];

            for (var i = 0; i < toggleableLayerIds.length; i++) {
                var id = toggleableLayerIds[i];

                var img = document.createElement('img');
                img.src = 'pics/mammal_color_tab.png'
                img.className = 'active'
                img.id = 'picture'
                img.textContent = id

                img.onclick = function(e) {
                    var clickedLayer = this.textContent;
                    e.preventDefault();
                    e.stopPropagation();

                    var visibility = map.getLayoutProperty(clickedLayer, 'visibility');

                    if (visibility === 'visible') {
                        map.setLayoutProperty(clickedLayer, 'visibility', 'none');
                        this.className = '';
                    } else {
                        this.className = 'active';
                        map.setLayoutProperty(clickedLayer, 'visibility', 'visible');
                    }

                };

                var layers = document.getElementById('mammal');
                layers.appendChild(img)
            }

            $(mammal).hover(
                function() {
                    $(this).append($("<span> mammals</span>"));
                },
                function() {
                    $(this).find("span:last").remove();
                }
            );


            var toggleableLayerIds = ['bird'];

            for (var i = 0; i < toggleableLayerIds.length; i++) {
                var id = toggleableLayerIds[i];

                var img = document.createElement('img');
                img.src = 'pics/bird_color_tab.png'
                img.className = 'active'
                img.id = 'picture'
                img.textContent = id

                img.onclick = function(e) {
                    var clickedLayer = this.textContent;
                    e.preventDefault();
                    e.stopPropagation();

                    var visibility = map.getLayoutProperty(clickedLayer, 'visibility');

                    if (visibility === 'visible') {
                        map.setLayoutProperty(clickedLayer, 'visibility', 'none');
                        this.className = '';
                    } else {
                        this.className = 'active';
                        map.setLayoutProperty(clickedLayer, 'visibility', 'visible');
                    }

                };

                var layers = document.getElementById('bird');
                layers.appendChild(img)
            }

            $(bird).hover(
                function() {
                    $(this).append($("<span> birds</span>"));
                },
                function() {
                    $(this).find("span:last").remove();
                }
            );



            var toggleableLayerIds = ['polygon'];

            for (var i = 0; i < toggleableLayerIds.length; i++) {
                var id = toggleableLayerIds[i];

                var img = document.createElement('img');
                img.src = 'pics/landscape_nav.png'
                img.className = 'active'
                img.id = 'amphibian'
                img.textContent = id

                img.onclick = function(e) {
                    var clickedLayer = this.textContent;
                    e.preventDefault();
                    e.stopPropagation();

                    var visibility = map.getLayoutProperty(clickedLayer, 'visibility');

                    if (visibility === 'visible') {
                        map.setLayoutProperty(clickedLayer, 'visibility', 'none');
                        this.className = '';
                    } else {
                        this.className = 'active';
                        map.setLayoutProperty(clickedLayer, 'visibility', 'visible');
                    }
                };

                var layers = document.getElementById('icon');
                layers.appendChild(img)
            }

            $(icon).hover(
                function() {
                    $(this).append($("<span> polygon</span>"));
                },
                function() {
                    $(this).find("span:last").remove();
                }
            );

            var toggleableLayerIds = ['points'];

            for (var i = 0; i < toggleableLayerIds.length; i++) {
                var id = toggleableLayerIds[i];

                var img = document.createElement('img');
                img.src = 'pics/protected_nav.png'
                img.className = 'active'
                img.id = 'picture'
                img.textContent = id

                img.onclick = function(e) {
                    var clickedLayer = this.textContent;
                    e.preventDefault();
                    e.stopPropagation();

                    var visibility = map.getLayoutProperty(clickedLayer, 'visibility');

                    if (visibility === 'visible') {
                        map.setLayoutProperty(clickedLayer, 'visibility', 'none');
                        this.className = '';
                    } else {
                        this.className = 'active';
                        map.setLayoutProperty(clickedLayer, 'visibility', 'visible');
                    }
                };

                var layers = document.getElementById('icon1');
                layers.appendChild(img)
            }

            $(icon1).hover(
                function() {
                    $(this).append($("<span> points</span>"));
                },
                function() {
                    $(this).find("span:last").remove();
                }
            );

            var toggleableLayerIds = ['species'];
            for (var i = 0; i < toggleableLayerIds.length; i++) {
                var id = toggleableLayerIds[i];

                var img = document.createElement('img');
                img.src = 'pics/wildlife_nav.png'
                img.className = 'active'
                img.id = 'picture'
                img.textContent = id

                img.onclick = function(e) {
                    var clickedLayer = this.textContent;
                    e.preventDefault();
                    e.stopPropagation();

                    var visibility = map.getLayoutProperty(clickedLayer, 'visibility');

                    if (visibility === 'visible') {
                        map.setLayoutProperty(clickedLayer, 'visibility', 'none');
                        this.className = '';
                    } else {
                        this.className = 'active';
                        map.setLayoutProperty(clickedLayer, 'visibility', 'visible');
                    }
                };

                var layers = document.getElementById('icon2');
                layers.appendChild(img)
            }

            $(icon2).hover(
                function() {
                    $(this).append($("<span> species</span>"));
                },
                function() {
                    $(this).find("span:last").remove();
                }
            );

            var endClicked = $('#icon-explore').on('click', function() {
                var endToggle = $('#aside-icon-explore').toggle()
                map.fitBounds([-75, -10, -25, -15], {
                    zoom: 2.6
                });
            });

            $('#icon-explore').off('click', endClicked);
        </script>

</body>

</html>