<!DOCTYPE html>
<html>

<head>
    <meta charset=utf-8 />
    <title>Conservation Areas in South America</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <script src='https://api.mapbox.com/mapbox.js/v3.2.0/mapbox.js'></script>
    <!-- added mapbox-gl-js to see if ocean loads -->
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.53.1/mapbox-gl.css' rel='stylesheet' />
    <!-- end of mapbox-gl-js to see if ocean loads -->
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
        integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <link href='https://api.mapbox.com/mapbox.js/v3.2.0/mapbox.css' rel='stylesheet' />

    <style>
        body {
            padding-top: 0;
        }

        #map {
            padding: 0;
            position: fixed;
            width: 100%;
            height: 100%;
        }

        .navbar-header {
            padding-top: 0rem;
            width: 26rem;
            position: fixed;
        }

        aside {
            width: 7rem;
            position: fixed;
            top: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.8);
        }

        .aside-chapters {
            padding-top: 1rem;
            padding-bottom: 1rem;
            padding-left: 1rem;
        }

        .aside-item {
            padding-top: 1rem;
        }

        a.img-hover:hover img {
            opacity: 0.3;
        }

        #features {
            padding-top: 10%;
            padding-bottom: 25%;
            width: 30%;
            margin-left: 10%;
            font-family: sans-serif;
            overflow-y: scroll;
            background-color: #fafafa;
            z-index: 1000;
        }

        section {
            padding: 20px 25px;
            line-height: 25px;
            border-bottom: 1px solid #ddd;
            opacity: 0.5;
            font-size: 13px;
        }

        section.active {
            opacity: 1;
        }

        section:last-child {
            border-bottom: none;
            margin-bottom: 200px;
        }

        /* .marker {
            background-image: url('pics/frog_icon.png');
            background-size: cover;
            width: 20px;
            height: 20px;
            border-radius: 5%;
            cursor: pointer;
        }  */

        /* .mapboxgl-popup {
            max-width: 200px;
        }

        .mapboxgl-popup-content {
            text-align: center;
            font-family: 'Open Sans', sans-serif;
        } */
    </style>
</head>

<body>
    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
        integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
        integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
        crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
        integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
        crossorigin="anonymous"></script>
    <!--adding libraries to see if ocean loads-->
    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.53.1/mapbox-gl.js'></script>
    <script src="https://d3js.org/d3-fetch.v1.min.js"></script>
    <script src="https://unpkg.com/topojson@3"></script>

    <!--scrolling libraries-->
    <!-- <script src="lib/d3.js"></script>
    <script src="js/scroller.js"></script>
    <script src="js/sections.js"></script> -->


    <div id='map'></div>

    <div class="navbar-header">
        <nav class="navbar navbar-expand-md navbar-dark navbar-fixed-top bg-dark">
            <a class="navbar-brand" href="#">Conservation</a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse"
                aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarCollapse">
                <ul class="navbar-nav mr-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="#">About</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">Take Action</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">Language</a>
                    </li>
                </ul>
            </div>
    </div><!-- /.navbar-header -->

    <aside class="aside">
        <ul class="aside-chapters">
            <li class="aside-item">
                <a href="https://getbootstrap.com" class="img-hover">
                    <img src="pics/story.png" alt="HTML tutorial" style="width:90px;height:90px;"></a>
            </li>
            <li class="aside-item">
                <a href="https://getbootstrap.com" class="img-hover">
                    <img src="pics/gallery.png" alt="HTML tutorial" style="width:90px;height:90px;"></a>
            </li>
            <li class="aside-item">
                <a href="https://getbootstrap.com" class="img-hover">
                    <img src="pics/explore.png" alt="HTML tutorial" style="width:90px;height:90px;"></a>
            </li>
        </ul>
    </aside>


    <!-- <aside class="hide-chapters">
            <nav id="module-links" class="">
              <ul class="nav">
                <li>
                  <a href="#" data-moduleid='story' class="reveal-on-hover module-link module-link-story" title="Story"> 
                    <div class="hide-on-hover hide-on-active icon-wwf_story"></div>
                    <div class="show-on-hover show-on-active icon-wwf_story-hover"></div>
                    <span class="hidden-xs hidden-sm">Story</span>
                  </a>
                  <ul class="story-nav hidden-xs hidden-sm">
                    
                    <li>
                      <a href="#" data-chapterid='1' class="icon-wwf_nav-circle module-link-chapter"> </a>
                    </li>
            
                    
                    <li>
                      <a href="#" data-chapterid='2' class="icon-wwf_nav-circle module-link-chapter"> </a>
                    </li>
                    
        
                    <li>
                      <a href="#" data-chapterid='3' class="icon-wwf_nav-circle module-link-chapter"> </a>
                    </li>
        
                    
                    <li>
                      <a href="#" data-chapterid='4' class="icon-wwf_nav-circle module-link-chapter"> </a>
                    </li>
                    
                    <li>
                      <a href="#" data-chapterid='5' class="icon-wwf_nav-circle module-link-chapter"> </a>
                    </li>
                    

                    <li>
                      <a href="#" data-chapterid='6' class="icon-wwf_nav-circle module-link-chapter"> </a>
                    </li>
                   
                    
                    <li>
                      <a href="#" data-chapterid='7' class="icon-wwf_nav-circle module-link-chapter"> </a>
                    </li>
                    
    
                    <li>
                      <a href="#" data-chapterid='8' class="icon-wwf_nav-circle module-link-chapter"> </a>
                    </li>
                    
   
                    <li>
                      <a href="#" data-chapterid='9' class="icon-wwf_nav-circle module-link-chapter"> </a>
                    </li>
                    
     
                    <li>
                      <a href="#" data-chapterid='10' class="icon-wwf_nav-circle module-link-chapter"> </a>
                    </li>
                    
           
                    
                    <li>
                      <a href="#" data-chapterid='11' class="icon-wwf_nav-circle module-link-chapter"> </a>
                    </li>
                    
                    
                  </ul>
                </li><li>
                  <a href="#" data-moduleid='gallery' class="reveal-on-hover module-link module-link-gallery" title="Gallery">
                    <div class="hide-on-hover hide-on-active icon-wwf_gallery"></div>
                    <div class="show-on-hover show-on-active icon-wwf_gallery-hover"></div>          
                    <span class="hidden-xs hidden-sm">Gallery</span>          
                  </a>
                </li><li>
                  <a href="#" data-moduleid='layers' class="reveal-on-hover module-link module-link-layers" title="Explore">
                    <div class="hide-on-hover hide-on-active icon-wwf_explore"></div>
                    <div class="show-on-hover show-on-active icon-wwf_explore-hover"></div>            
                    <span class="hidden-xs hidden-sm">Explore</span>          
                  </a>
                </li>
              </ul>
            </nav>
            <div class="placeholder-map-key"></div>
            <nav id="other-links" class=""></nav>
          </aside> -->


    <div id='features'>
        <section id='introduction' class='active'>
            <h3>Conservation Areas in South America</h3>
            <p></p>
        </section>
        <section id='argentina'>
            <h3>Argentina</h3>
            <p>Argentina</p>
        </section>
        <section id='bolivia'>
            <h3>Bolivia</h3>
            <p>Bolivia</p>
        </section>
        <section id='brasil'>
            <h3>Brasil</h3>
            <p>Brasil</p>
        </section>
        <section id='chile'>
            <h3>Chile</h3>
            <p>Chile</p>
        </section>
        <section id='colombia'>
            <h3>Colombia</h3>
            <p>Colombia</p>
        </section>
        <section id='ecuador'>
            <h3>Ecuador</h3>
            <p>Ecuador</p>
        </section>
        <section id='french guiana'>
            <h3>French Guiana</h3>
            <p>French Guiana</p>
        </section>
        <section id='guyana'>
            <h3>Guyana</h3>
            <p>Guyana</p>
        </section>
        <section id='paraguay'>
            <h3>Paraguay</h3>
            <p>Paraguay</p>
        </section>
        <section id='peru'>
            <h3>Peru</h3>
            <p>Peru</p>
        </section>
        <section id='surinam'>
            <h3>Surinam</h3>
            <p>Surinam</p>
        </section>
        <section id='uruguay'>
            <h3>Uruguay</h3>
            <p>Uruguay</p>
        </section>
        <section id='venezuela'>
            <h3>Venezuela</h3>
            <p>Venezuela</p>
            <small id="THANK YOU">
                Tank you! <a href='http://www.gutenberg.org/files/2346/2346-h/2346-h.htm'>Project Gutenberg</a>
            </small>
        </section>
    </div>

    <script>

        mapboxgl.accessToken = 'pk.eyJ1IjoibWFob3JuIiwiYSI6ImNpbnV0enJ4ZTEyNG91YW0zNGF6bTlva2wifQ.7jRtxQoaV2PHlRD7fu6U-g';

        var categoriesGlobal = {
            layers: [{ "value": "wildlife", "icon": "wildlife", "color": "#02B3BC" }, { "value": "vegetation", "icon": "vegetation", "color": "#524484" }, { "value": "landscape", "icon": "landscape", "color": "#4B5C65" }, { "value": "protected", "icon": "protected", "color": "#46DB91" }],
            gallery: [{ "value": "wildlife", "icon": "wildlife", "color": "#02B3BC" }, { "value": "vegetation", "icon": "vegetation", "color": "#524484" }, { "value": "landscape", "icon": "landscape", "color": "#46DB91" }]
        }

        var map = new mapboxgl.Map({
            container: 'map',
            style: 'mapbox://styles/mapbox/light-v9',
            //     center: [2.28, 11.77], // starting position [lng, lat]
            // zoom: 1.2 
            center: [-65, -15],
            zoom: 3.2,

        });

        // <!-- DATA TO LOAD OCEAN TOPOJSON FILE WITH D3 -->

        // var colorCodes = {
        //     0: "#60a3b4",
        //     200: "#6dabba",
        //     1000: "#7ab3c1",
        //     2000: "#88bac7",
        //     3000: "#95c2cd",
        //     4000: "#a2cad3",
        //     5000: "#b0d1da",
        //     6000: "#bdd9e0",
        //     7000: "#cae1e6",
        //     8000: "#d8e8ed",
        //     9000: "#e5f0f3",
        //     10000: "#f2f8f9"
        // }

        // // when the map is done loading
        // map.on('load', function () {

        //     // request our GEOJSON data
        //     d3.json('data/ocean.json')
        //         .then(function (data) {
        //             console.log(data);
        //             oceanMap(data);
        //         });

        //     function oceanMap(data) {
        //         var geojson = topojson.feature(data, data.objects.ocean);
        //         console.log(geojson);

        //         map.addLayer({
        //             'id': 'ocean',
        //             'type': 'fill',
        //             'source': {
        //                 'type': 'geojson',
        //                 'data': geojson// use the data as the data source
        //             },
        //             'paint': {
        //                 "fill-color": [
        //                     "match", // match the numbers below to the depth
        //                     ["number", ["get", "depth"]],
        //                     0, colorCodes[0],
        //                     200, colorCodes[200],
        //                     1000, colorCodes[1000],
        //                     2000, colorCodes[2000],
        //                     3000, colorCodes[3000],
        //                     4000, colorCodes[4000],
        //                     5000, colorCodes[5000],
        //                     6000, colorCodes[6000],
        //                     7000, colorCodes[7000],
        //                     8000, colorCodes[8000],
        //                     9000, colorCodes[9000],
        //                     10000, colorCodes[10000],
        //                     "#000000" // default for no match
        //                 ],
        //                 "fill-opacity": 0.18,
        //                 "fill-outline-color": "hsla(180, 100%, 50%, 0.3)"
        //             }
        //         });
        //     }



        map.on('load', function () {
            //  request our GEOJSON data
            d3.json('data/ocean.json')
                .then(function (data) {
                    // console.log(data);
                    oceanMap(data);
                });

            function oceanMap(data) {

                var geojson = topojson.feature(data, data.objects.ocean);

                map.addLayer({
                    'id': 'ocean',
                    'type': 'fill',
                    'source': {
                        'type': 'geojson',
                        'data': geojson// use the data as the data source
                    },
                    'paint': {
                        "fill-outline-color": "hsla(337, 82%, 62%, 0)",
                        "fill-color": ["interpolate",
                            ["cubic-bezier",
                                0, 0.5,
                                1, 0.5],
                            ["get", "depth"],
                            0, "#f2f8fa",
                            9000, "#a7ccd2"
                        ],
                        "fill-opacity": 0.4
                    }
                });
            } //end of oceanMap function

            d3.json('data/polygons.json')
                .then(function (data) {
                    // console.log(data);
                    polygonsMap(data);
                });

            function polygonsMap(data) {
                var geojson = topojson.feature(data, data.objects.merge_files_sim);

                map.addLayer({
                    'id': 'polygon',
                    'type': 'fill',
                    'source': {
                        'type': 'geojson',
                        'data': geojson// use the data as the data source
                    },
                    'paint': {
                        "fill-color": [
                            'match',
                            ['get', 'IUCN_CAT'],
                            'Ia', '#505160',
                            'Ib', '#68829e',
                            'II', '#aebd38',
                            'III', '#598234',
                            'IV', '#003b46',
                            'V', '#07575b',
                            'VI', '#66a5ad',
                            'Not Reported', '#c4dfe6',
                            'Not Applicable', '#a2c523',
                            '#ccc'
                        ],
                        "fill-opacity": 0.3,
                    },
                    
                });

                // var popup = new mapboxgl.Popup({
                //     closeButton: false,
                //     closeOnClick: false
                // });

                map.on('mousemove', 'polygon', function (e) {
                    var features = map.queryRenderedFeatures(e.lngLat);
                    map.getCanvas().style.cursor = 'pointer';
                    popup.setLngLat(e.lngLat)
                        .setHTML("Name: " + String(e.features[0].properties.NAME).toLocaleString())
                        .addTo(map)
                });
                map.on('mouseleave', 'polygon', function () {
                    map.getCanvas().style.cursor = '';
                    popup.remove();
                });

            } //end of polygonsMap function


            d3.json('data/points.json')
                .then(function (data) {
                    pointsMap(data);
                });

            function pointsMap(data) {
                map.addLayer({
                    'id': 'points',
                    'type': 'circle',
                    'source': {
                        'type': 'geojson',
                        'data': data// use the data as the data source
                        //   'cluster': true,
                        //   'clusterMaxZoom': 4, // Max zoom to cluster points on
                        //  'clusterRadius': 2 // Radius of each cluster when clustering points (defaults to 50)
                    },
                    'paint': {
                        'circle-color': [
                            'match',
                            ['get', 'IUCN_CAT'],
                            'Ia', '#505160',
                            'Ib', '#68829e',
                            'II', '#aebd38',
                            'III', '#598234',
                            'IV', '#003b46',
                            'V', '#07575b',
                            'VI', '#66a5ad',
                            'Not Reported', '#c4dfe6',
                            'Not Applicable', '#a2c523',
                            '#ccc'
                        ],
                        'circle-radius': 6,
                        'circle-opacity': .6,
                    },
                    
                });

                var popup = new mapboxgl.Popup({
                    closeButton: false,
                    closeOnClick: false
                });

                map.on('mousemove', 'points', function (e) {
                    var features = map.queryRenderedFeatures(e.lngLat);
                    map.getCanvas().style.cursor = 'pointer';
                    popup.setLngLat(e.lngLat)
                        .setHTML("Name: " + String(e.features[0].properties.NAME).toLocaleString())
                        .addTo(map)
                });
                map.on('mouseleave', 'points', function () {
                    map.getCanvas().style.cursor = '';
                    popup.remove();
                });

                // add markers to map
                // data.features.forEach(function (marker) {

                //     // create a HTML element for each feature
                //     var el = document.createElement('div');
                //     el.className = 'marker';

                //     // make a marker for each feature and add to the map
                //     new mapboxgl.Marker(el)
                //         .setLngLat(marker.geometry.coordinates)
                //         .setPopup(new mapboxgl.Popup({ offset: 25 }) // add popups
                //             .setHTML('<h3>' + marker.properties.NAME + '</h3><p>' + marker.properties.DESIG_ENG + '</p><p>' + marker.properties.IUCN_CAT + '</p>'))
                //         .addTo(map);
                // });

            } //end of function pointsMap



            //FLY TO BOUNDS WHEN MAP LOADS

            // map will flyTo the bounds provided
            // map.fitBounds([-80.07,-1.02,-65.74,-15.53], {
            //     padding: {
            //         top: 12, bottom: 18, left: 12, right: 220
            //     }
            // });

            // var onZoomend = function() {
            //     // set the max bounds
            //     map.setMaxBounds(map.getBounds())

            //     // display the legend
            //     d3.select('#legend').classed('none', false);

            //     // remove the listener
            //     map.off('zoomend', onZoomend);
            // };

            // // when the map is done zooming
            // map.on('zoomend', onZoomend);

            //FLY TO BOUNDS WHEN MAP LOADS ENDS


        }); //end of map.on('load')

        var chapters = {
            'introduction': {
                center: [-65, -15],
                zoom: 3.2,
            },
            'argentina': {
                center: [-63.6167, -38.4161],
                zoom: 3.5,
            },
            'bolivia': {
                center: [-63.5887, -16.2902],
                zoom: 5,
            },
            'brasil': {
                center: [-55.9253, -12.2350],
                zoom: 3.8,
            },
            'chile': {
                center: [-71.5430, -38.4161],
                zoom: 4
            },
            'colombia': {
                center: [-74.2973, 2.5709],
                zoom: 5,
            },
            'ecuador': {
                center: [-78.1834, -1.8312],
                zoom: 6
            },
            'french guiana': {
                center: [-53.1258, 3.9339],
                zoom: 6,
            },
            'guyana': {
                center: [-58.9302, 2.5904],
                zoom: 5.5,
            },
            'paraguay': {
                center: [-58.4438, -23.4425],
                zoom: 5.5,
            },
            'peru': {
                center: [-75.0152, -9.1900],
                zoom: 5,
            },
            'surinam': {
                center: [-55.9302, 2.3904],
                zoom: 6,
            },
            'uruguay': {
                center: [-55.8117 - 32.5583],
                zoom: 5,
            },
            'venezuela': {
                center: [-66.5897, -6.4238],
                zoom: 4,
            }
        };

        // On every scroll event, check which element is on screen
        window.onscroll = function () {
            var chapterNames = Object.keys(chapters);
            for (var i = 0; i < chapterNames.length; i++) {
                var chapterName = chapterNames[i];
                if (isElementOnScreen(chapterName)) {
                    setActiveChapter(chapterName);
                    break;
                }
            }
        };

        var activeChapterName = 'introduction';
        function setActiveChapter(chapterName) {
            if (chapterName === activeChapterName) return;

            map.flyTo(chapters[chapterName]);

            document.getElementById(chapterName).setAttribute('class', 'active');
            document.getElementById(activeChapterName).setAttribute('class', '');

            activeChapterName = chapterName;
        }

        function isElementOnScreen(id) {
            var element = document.getElementById(id);
            var bounds = element.getBoundingClientRect();
            return bounds.top < window.innerHeight && bounds.top > 0;
        }

    </script>

</body>

</html>